<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 2 Data – Reading, Wrangling, and Writing | Elements of Statistical Modeling for Experimental Biology</title>
  <meta name="description" content="A first course in statistical modeling for experimental biology researchers" />
  <meta name="generator" content="bookdown 0.14 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 2 Data – Reading, Wrangling, and Writing | Elements of Statistical Modeling for Experimental Biology" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="A first course in statistical modeling for experimental biology researchers" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 2 Data – Reading, Wrangling, and Writing | Elements of Statistical Modeling for Experimental Biology" />
  
  <meta name="twitter:description" content="A first course in statistical modeling for experimental biology researchers" />
  

<meta name="author" content="Copyright 2018 Jeffrey A. Walker" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="organization-r-projects-and-r-notebooks.html"/>
<link rel="next" href="plotting-models.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Elements of Applied Biostatistics</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a><ul>
<li class="chapter" data-level="0.1" data-path="index.html"><a href="index.html#math"><i class="fa fa-check"></i><b>0.1</b> Math</a></li>
<li class="chapter" data-level="0.2" data-path="index.html"><a href="index.html#r-and-programming"><i class="fa fa-check"></i><b>0.2</b> R and programming</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="part-i-r-fundamentals.html"><a href="part-i-r-fundamentals.html"><i class="fa fa-check"></i>Part I: R fundamentals</a></li>
<li class="chapter" data-level="1" data-path="organization-r-projects-and-r-notebooks.html"><a href="organization-r-projects-and-r-notebooks.html"><i class="fa fa-check"></i><b>1</b> Organization – R Projects and R Notebooks</a><ul>
<li class="chapter" data-level="1.1" data-path="organization-r-projects-and-r-notebooks.html"><a href="organization-r-projects-and-r-notebooks.html#r-vs-r-studio"><i class="fa fa-check"></i><b>1.1</b> R vs R Studio</a></li>
<li class="chapter" data-level="1.2" data-path="organization-r-projects-and-r-notebooks.html"><a href="organization-r-projects-and-r-notebooks.html#r-notebook-vs.-r-markdown"><i class="fa fa-check"></i><b>1.2</b> R Notebook vs. R Markdown</a></li>
<li class="chapter" data-level="1.3" data-path="organization-r-projects-and-r-notebooks.html"><a href="organization-r-projects-and-r-notebooks.html#importing-packages"><i class="fa fa-check"></i><b>1.3</b> Importing Packages</a></li>
<li class="chapter" data-level="1.4" data-path="organization-r-projects-and-r-notebooks.html"><a href="organization-r-projects-and-r-notebooks.html#create-an-r-studio-project-for-this-textbook"><i class="fa fa-check"></i><b>1.4</b> Create an R Studio Project for this textbook</a><ul>
<li class="chapter" data-level="1.4.1" data-path="organization-r-projects-and-r-notebooks.html"><a href="organization-r-projects-and-r-notebooks.html#create-an-r-notebook-for-this-chapter"><i class="fa fa-check"></i><b>1.4.1</b> Create an R Notebook for this Chapter</a></li>
<li class="chapter" data-level="1.4.2" data-path="organization-r-projects-and-r-notebooks.html"><a href="organization-r-projects-and-r-notebooks.html#create-a-fake-data-chunk"><i class="fa fa-check"></i><b>1.4.2</b> Create a “fake-data” chunk</a></li>
<li class="chapter" data-level="1.4.3" data-path="organization-r-projects-and-r-notebooks.html"><a href="organization-r-projects-and-r-notebooks.html#create-a-plot-chunk"><i class="fa fa-check"></i><b>1.4.3</b> Create a “plot” chunk</a></li>
<li class="chapter" data-level="1.4.4" data-path="organization-r-projects-and-r-notebooks.html"><a href="organization-r-projects-and-r-notebooks.html#knit"><i class="fa fa-check"></i><b>1.4.4</b> Knit</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="data-reading-wrangling-and-writing.html"><a href="data-reading-wrangling-and-writing.html"><i class="fa fa-check"></i><b>2</b> Data – Reading, Wrangling, and Writing</a><ul>
<li class="chapter" data-level="2.1" data-path="data-reading-wrangling-and-writing.html"><a href="data-reading-wrangling-and-writing.html#learning-from-this-chapter"><i class="fa fa-check"></i><b>2.1</b> Learning from this chapter</a></li>
<li class="chapter" data-level="2.2" data-path="data-reading-wrangling-and-writing.html"><a href="data-reading-wrangling-and-writing.html#data-working-in-r"><i class="fa fa-check"></i><b>2.2</b> Working in R</a><ul>
<li class="chapter" data-level="2.2.1" data-path="data-reading-wrangling-and-writing.html"><a href="data-reading-wrangling-and-writing.html#importing-data"><i class="fa fa-check"></i><b>2.2.1</b> Importing data</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="data-reading-wrangling-and-writing.html"><a href="data-reading-wrangling-and-writing.html#data-wrangling"><i class="fa fa-check"></i><b>2.3</b> Data wrangling</a><ul>
<li class="chapter" data-level="2.3.1" data-path="data-reading-wrangling-and-writing.html"><a href="data-reading-wrangling-and-writing.html#reshaping-data-wide-to-long"><i class="fa fa-check"></i><b>2.3.1</b> Reshaping data – Wide to long</a></li>
<li class="chapter" data-level="2.3.2" data-path="data-reading-wrangling-and-writing.html"><a href="data-reading-wrangling-and-writing.html#reshaping-data-transpose-turning-the-columns-into-rows"><i class="fa fa-check"></i><b>2.3.2</b> Reshaping data – Transpose (turning the columns into rows)</a></li>
<li class="chapter" data-level="2.3.3" data-path="data-reading-wrangling-and-writing.html"><a href="data-reading-wrangling-and-writing.html#combining-data"><i class="fa fa-check"></i><b>2.3.3</b> Combining data</a></li>
<li class="chapter" data-level="2.3.4" data-path="data-reading-wrangling-and-writing.html"><a href="data-reading-wrangling-and-writing.html#subsetting-data"><i class="fa fa-check"></i><b>2.3.4</b> Subsetting data</a></li>
<li class="chapter" data-level="2.3.5" data-path="data-reading-wrangling-and-writing.html"><a href="data-reading-wrangling-and-writing.html#wrangling-columns"><i class="fa fa-check"></i><b>2.3.5</b> Wrangling columns</a></li>
<li class="chapter" data-level="2.3.6" data-path="data-reading-wrangling-and-writing.html"><a href="data-reading-wrangling-and-writing.html#missing-data"><i class="fa fa-check"></i><b>2.3.6</b> Missing data</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="data-reading-wrangling-and-writing.html"><a href="data-reading-wrangling-and-writing.html#saving-data"><i class="fa fa-check"></i><b>2.4</b> Saving data</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="plotting-models.html"><a href="plotting-models.html"><i class="fa fa-check"></i><b>3</b> Plotting Models</a><ul>
<li class="chapter" data-level="3.1" data-path="plotting-models.html"><a href="plotting-models.html#pretty-good-plots-show-the-model-and-the-data"><i class="fa fa-check"></i><b>3.1</b> Pretty good plots show the model and the data</a><ul>
<li class="chapter" data-level="3.1.1" data-path="plotting-models.html"><a href="plotting-models.html#pretty-good-plot-component-1-modeled-effects-plot"><i class="fa fa-check"></i><b>3.1.1</b> Pretty good plot component 1: Modeled effects plot</a></li>
<li class="chapter" data-level="3.1.2" data-path="plotting-models.html"><a href="plotting-models.html#pretty-good-plot-component-2-modeled-mean-and-ci-plot"><i class="fa fa-check"></i><b>3.1.2</b> Pretty good plot component 2: Modeled mean and CI plot</a></li>
<li class="chapter" data-level="3.1.3" data-path="plotting-models.html"><a href="plotting-models.html#combining-effects-and-modeled-mean-and-ci-plots-an-effects-and-response-plot."><i class="fa fa-check"></i><b>3.1.3</b> Combining Effects and Modeled mean and CI plots – an Effects and response plot.</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="plotting-models.html"><a href="plotting-models.html#some-comments-on-plot-components"><i class="fa fa-check"></i><b>3.2</b> Some comments on plot components</a></li>
<li class="chapter" data-level="3.3" data-path="plotting-models.html"><a href="plotting-models.html#working-in-r"><i class="fa fa-check"></i><b>3.3</b> Working in R</a><ul>
<li class="chapter" data-level="3.3.1" data-path="plotting-models.html"><a href="plotting-models.html#unpooled-se-bars-and-confidence-intervals"><i class="fa fa-check"></i><b>3.3.1</b> Unpooled SE bars and confidence intervals</a></li>
<li class="chapter" data-level="3.3.2" data-path="plotting-models.html"><a href="plotting-models.html#adding-bootstrap-intervals"><i class="fa fa-check"></i><b>3.3.2</b> Adding bootstrap intervals</a></li>
<li class="chapter" data-level="3.3.3" data-path="plotting-models.html"><a href="plotting-models.html#adding-modeled-means-and-error-intervals"><i class="fa fa-check"></i><b>3.3.3</b> Adding modeled means and error intervals</a></li>
<li class="chapter" data-level="3.3.4" data-path="plotting-models.html"><a href="plotting-models.html#adding-p-values"><i class="fa fa-check"></i><b>3.3.4</b> Adding p-values</a></li>
<li class="chapter" data-level="3.3.5" data-path="plotting-models.html"><a href="plotting-models.html#adding-custom-p-values"><i class="fa fa-check"></i><b>3.3.5</b> Adding custom p-values</a></li>
<li class="chapter" data-level="3.3.6" data-path="plotting-models.html"><a href="plotting-models.html#plotting-two-factors"><i class="fa fa-check"></i><b>3.3.6</b> Plotting two factors</a></li>
<li class="chapter" data-level="3.3.7" data-path="plotting-models.html"><a href="plotting-models.html#interaction-plot"><i class="fa fa-check"></i><b>3.3.7</b> Interaction plot</a></li>
<li class="chapter" data-level="3.3.8" data-path="plotting-models.html"><a href="plotting-models.html#plot-components"><i class="fa fa-check"></i><b>3.3.8</b> Plot components</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="part-ii-some-fundamentals-of-statistical-modeling.html"><a href="part-ii-some-fundamentals-of-statistical-modeling.html"><i class="fa fa-check"></i>Part II: Some Fundamentals of Statistical Modeling</a></li>
<li class="chapter" data-level="4" data-path="variability-and-uncertainty-standard-deviations-standard-errors-confidence-intervals.html"><a href="variability-and-uncertainty-standard-deviations-standard-errors-confidence-intervals.html"><i class="fa fa-check"></i><b>4</b> Variability and Uncertainty (Standard Deviations, Standard Errors, Confidence Intervals)</a><ul>
<li class="chapter" data-level="4.1" data-path="variability-and-uncertainty-standard-deviations-standard-errors-confidence-intervals.html"><a href="variability-and-uncertainty-standard-deviations-standard-errors-confidence-intervals.html#the-sample-standard-deviation-vs.-the-standard-error-of-the-mean"><i class="fa fa-check"></i><b>4.1</b> The sample standard deviation vs. the standard error of the mean</a><ul>
<li class="chapter" data-level="4.1.1" data-path="variability-and-uncertainty-standard-deviations-standard-errors-confidence-intervals.html"><a href="variability-and-uncertainty-standard-deviations-standard-errors-confidence-intervals.html#sample-standard-deviation"><i class="fa fa-check"></i><b>4.1.1</b> Sample standard deviation</a></li>
<li class="chapter" data-level="4.1.2" data-path="variability-and-uncertainty-standard-deviations-standard-errors-confidence-intervals.html"><a href="variability-and-uncertainty-standard-deviations-standard-errors-confidence-intervals.html#standard-error-of-the-mean"><i class="fa fa-check"></i><b>4.1.2</b> Standard error of the mean</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="variability-and-uncertainty-standard-deviations-standard-errors-confidence-intervals.html"><a href="variability-and-uncertainty-standard-deviations-standard-errors-confidence-intervals.html#using-google-sheets-to-generate-fake-data-to-explore-the-standard-error"><i class="fa fa-check"></i><b>4.2</b> Using Google Sheets to generate fake data to explore the standard error</a><ul>
<li class="chapter" data-level="4.2.1" data-path="variability-and-uncertainty-standard-deviations-standard-errors-confidence-intervals.html"><a href="variability-and-uncertainty-standard-deviations-standard-errors-confidence-intervals.html#steps"><i class="fa fa-check"></i><b>4.2.1</b> Steps</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="variability-and-uncertainty-standard-deviations-standard-errors-confidence-intervals.html"><a href="variability-and-uncertainty-standard-deviations-standard-errors-confidence-intervals.html#using-r-to-generate-fake-data-to-explore-the-standard-error"><i class="fa fa-check"></i><b>4.3</b> Using R to generate fake data to explore the standard error</a><ul>
<li class="chapter" data-level="4.3.1" data-path="variability-and-uncertainty-standard-deviations-standard-errors-confidence-intervals.html"><a href="variability-and-uncertainty-standard-deviations-standard-errors-confidence-intervals.html#part-i"><i class="fa fa-check"></i><b>4.3.1</b> part I</a></li>
<li class="chapter" data-level="4.3.2" data-path="variability-and-uncertainty-standard-deviations-standard-errors-confidence-intervals.html"><a href="variability-and-uncertainty-standard-deviations-standard-errors-confidence-intervals.html#part-ii---means"><i class="fa fa-check"></i><b>4.3.2</b> part II - means</a></li>
<li class="chapter" data-level="4.3.3" data-path="variability-and-uncertainty-standard-deviations-standard-errors-confidence-intervals.html"><a href="variability-and-uncertainty-standard-deviations-standard-errors-confidence-intervals.html#part-iii---how-do-sd-and-se-change-as-sample-size-n-increases"><i class="fa fa-check"></i><b>4.3.3</b> part III - how do SD and SE change as sample size (n) increases?</a></li>
<li class="chapter" data-level="4.3.4" data-path="variability-and-uncertainty-standard-deviations-standard-errors-confidence-intervals.html"><a href="variability-and-uncertainty-standard-deviations-standard-errors-confidence-intervals.html#part-iv-generating-fake-data-with-for-loops"><i class="fa fa-check"></i><b>4.3.4</b> Part IV – Generating fake data with for-loops</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="variability-and-uncertainty-standard-deviations-standard-errors-confidence-intervals.html"><a href="variability-and-uncertainty-standard-deviations-standard-errors-confidence-intervals.html#bootstrap"><i class="fa fa-check"></i><b>4.4</b> Bootstrapped standard errors</a><ul>
<li class="chapter" data-level="4.4.1" data-path="variability-and-uncertainty-standard-deviations-standard-errors-confidence-intervals.html"><a href="variability-and-uncertainty-standard-deviations-standard-errors-confidence-intervals.html#an-example-of-bootstrapped-standard-errors-using-vole-data"><i class="fa fa-check"></i><b>4.4.1</b> An example of bootstrapped standard errors using vole data</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="variability-and-uncertainty-standard-deviations-standard-errors-confidence-intervals.html"><a href="variability-and-uncertainty-standard-deviations-standard-errors-confidence-intervals.html#confidence-interval"><i class="fa fa-check"></i><b>4.5</b> Confidence Interval</a><ul>
<li class="chapter" data-level="4.5.1" data-path="variability-and-uncertainty-standard-deviations-standard-errors-confidence-intervals.html"><a href="variability-and-uncertainty-standard-deviations-standard-errors-confidence-intervals.html#interpretation-of-a-confidence-interval"><i class="fa fa-check"></i><b>4.5.1</b> Interpretation of a confidence interval</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="p-values.html"><a href="p-values.html"><i class="fa fa-check"></i><b>5</b> P-values</a><ul>
<li class="chapter" data-level="5.1" data-path="p-values.html"><a href="p-values.html#p-values-1"><i class="fa fa-check"></i><b>5.1</b> <span class="math inline">\(p\)</span>-values</a></li>
<li class="chapter" data-level="5.2" data-path="p-values.html"><a href="p-values.html#creating-a-null-distribution."><i class="fa fa-check"></i><b>5.2</b> Creating a null distribution.</a><ul>
<li class="chapter" data-level="5.2.1" data-path="p-values.html"><a href="p-values.html#the-null-distribution"><i class="fa fa-check"></i><b>5.2.1</b> the Null Distribution</a></li>
<li class="chapter" data-level="5.2.2" data-path="p-values.html"><a href="p-values.html#t-tests"><i class="fa fa-check"></i><b>5.2.2</b> t-tests</a></li>
<li class="chapter" data-level="5.2.3" data-path="p-values.html"><a href="p-values.html#p-values-from-the-perspective-of-permutation"><i class="fa fa-check"></i><b>5.2.3</b> P-values from the perspective of permutation</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="p-values.html"><a href="p-values.html#statistical-modeling-instead-of-hypothesis-testing"><i class="fa fa-check"></i><b>5.3</b> Statistical modeling instead of hypothesis testing</a></li>
<li class="chapter" data-level="5.4" data-path="p-values.html"><a href="p-values.html#frequentist-probability-and-the-interpretation-of-p-values"><i class="fa fa-check"></i><b>5.4</b> frequentist probability and the interpretation of p-values</a><ul>
<li class="chapter" data-level="5.4.1" data-path="p-values.html"><a href="p-values.html#background"><i class="fa fa-check"></i><b>5.4.1</b> Background</a></li>
<li class="chapter" data-level="5.4.2" data-path="p-values.html"><a href="p-values.html#this-book-covers-frequentist-approaches-to-statistical-modeling-and-when-a-probability-arises-such-as-the-p-value-of-a-test-statistic-this-will-be-a-frequentist-probability."><i class="fa fa-check"></i><b>5.4.2</b> This book covers frequentist approaches to statistical modeling and when a probability arises, such as the <em>p</em>-value of a test statistic, this will be a frequentist probability.</a></li>
<li class="chapter" data-level="5.4.3" data-path="p-values.html"><a href="p-values.html#two-interpretations-of-the-p-value"><i class="fa fa-check"></i><b>5.4.3</b> Two interpretations of the <em>p</em>-value</a></li>
<li class="chapter" data-level="5.4.4" data-path="p-values.html"><a href="p-values.html#nhst"><i class="fa fa-check"></i><b>5.4.4</b> NHST</a></li>
<li class="chapter" data-level="5.4.5" data-path="p-values.html"><a href="p-values.html#some-major-misconceptions-of-the-p-value"><i class="fa fa-check"></i><b>5.4.5</b> Some major misconceptions of the <span class="math inline">\(p\)</span>-value</a></li>
<li class="chapter" data-level="5.4.6" data-path="p-values.html"><a href="p-values.html#recommendations"><i class="fa fa-check"></i><b>5.4.6</b> Recommendations</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="p-values.html"><a href="p-values.html#problems"><i class="fa fa-check"></i><b>5.5</b> Problems</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="part-iii-introduction-to-linear-models.html"><a href="part-iii-introduction-to-linear-models.html"><i class="fa fa-check"></i>Part III: Introduction to Linear Models</a></li>
<li class="chapter" data-level="6" data-path="an-introduction-to-statistical-modeling.html"><a href="an-introduction-to-statistical-modeling.html"><i class="fa fa-check"></i><b>6</b> An Introduction to Statistical Modeling</a><ul>
<li class="chapter" data-level="6.1" data-path="an-introduction-to-statistical-modeling.html"><a href="an-introduction-to-statistical-modeling.html#two-specifications-of-a-linear-model"><i class="fa fa-check"></i><b>6.1</b> Two specifications of a linear model</a><ul>
<li class="chapter" data-level="6.1.1" data-path="an-introduction-to-statistical-modeling.html"><a href="an-introduction-to-statistical-modeling.html#the-error-draw-specification"><i class="fa fa-check"></i><b>6.1.1</b> The “error draw” specification</a></li>
<li class="chapter" data-level="6.1.2" data-path="an-introduction-to-statistical-modeling.html"><a href="an-introduction-to-statistical-modeling.html#the-conditional-draw-specification"><i class="fa fa-check"></i><b>6.1.2</b> The “conditional draw” specification</a></li>
<li class="chapter" data-level="6.1.3" data-path="an-introduction-to-statistical-modeling.html"><a href="an-introduction-to-statistical-modeling.html#comparing-the-two-ways-of-specifying-the-linear-model"><i class="fa fa-check"></i><b>6.1.3</b> Comparing the two ways of specifying the linear model</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="an-introduction-to-statistical-modeling.html"><a href="an-introduction-to-statistical-modeling.html#statistical-models-are-used-for-prediction-explanation-and-description"><i class="fa fa-check"></i><b>6.2</b> Statistical models are used for prediction, explanation, and description</a></li>
<li class="chapter" data-level="6.3" data-path="an-introduction-to-statistical-modeling.html"><a href="an-introduction-to-statistical-modeling.html#what-do-we-call-the-x-and-y-variables"><i class="fa fa-check"></i><b>6.3</b> What do we call the <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span> variables?</a></li>
<li class="chapter" data-level="6.4" data-path="an-introduction-to-statistical-modeling.html"><a href="an-introduction-to-statistical-modeling.html#modeling-strategy"><i class="fa fa-check"></i><b>6.4</b> Modeling strategy</a></li>
<li class="chapter" data-level="6.5" data-path="an-introduction-to-statistical-modeling.html"><a href="an-introduction-to-statistical-modeling.html#fitting-the-model"><i class="fa fa-check"></i><b>6.5</b> Fitting the model</a></li>
<li class="chapter" data-level="6.6" data-path="an-introduction-to-statistical-modeling.html"><a href="an-introduction-to-statistical-modeling.html#models-fit-to-data-in-which-the-x-are-treatment-variables-are-regression-models"><i class="fa fa-check"></i><b>6.6</b> Models fit to data in which the <span class="math inline">\(X\)</span> are treatment variables are regression models</a></li>
<li class="chapter" data-level="6.7" data-path="an-introduction-to-statistical-modeling.html"><a href="an-introduction-to-statistical-modeling.html#assumptions-for-inference-with-a-statistical-model"><i class="fa fa-check"></i><b>6.7</b> Assumptions for inference with a statistical model</a></li>
<li class="chapter" data-level="6.8" data-path="an-introduction-to-statistical-modeling.html"><a href="an-introduction-to-statistical-modeling.html#specific-assumptions-for-inference-with-a-linear-model"><i class="fa fa-check"></i><b>6.8</b> Specific assumptions for inference with a linear model</a></li>
<li class="chapter" data-level="6.9" data-path="an-introduction-to-statistical-modeling.html"><a href="an-introduction-to-statistical-modeling.html#linear-modelregression-model-orstatistical-model"><i class="fa fa-check"></i><b>6.9</b> “linear model,”regression model“, or”statistical model"?</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="models-with-a-single-continuous-x.html"><a href="models-with-a-single-continuous-x.html"><i class="fa fa-check"></i><b>7</b> Models with a single, continuous <em>X</em></a><ul>
<li class="chapter" data-level="7.1" data-path="models-with-a-single-continuous-x.html"><a href="models-with-a-single-continuous-x.html#a-linear-model-with-a-single-continuous-x-is-classical-regression"><i class="fa fa-check"></i><b>7.1</b> A linear model with a single, continuous <em>X</em> is classical “regression”</a><ul>
<li class="chapter" data-level="7.1.1" data-path="models-with-a-single-continuous-x.html"><a href="models-with-a-single-continuous-x.html#analysis-of-green-down-data"><i class="fa fa-check"></i><b>7.1.1</b> Analysis of “green-down” data</a></li>
<li class="chapter" data-level="7.1.2" data-path="models-with-a-single-continuous-x.html"><a href="models-with-a-single-continuous-x.html#learning-from-the-green-down-example"><i class="fa fa-check"></i><b>7.1.2</b> Learning from the green-down example</a></li>
<li class="chapter" data-level="7.1.3" data-path="models-with-a-single-continuous-x.html"><a href="models-with-a-single-continuous-x.html#what-a-regression-coefficient-means"><i class="fa fa-check"></i><b>7.1.3</b> What a regression coefficient means</a></li>
<li class="chapter" data-level="7.1.4" data-path="models-with-a-single-continuous-x.html"><a href="models-with-a-single-continuous-x.html#using-the-linear-model-for-prediction-prediction-models"><i class="fa fa-check"></i><b>7.1.4</b> Using the linear model for prediction – prediction models</a></li>
<li class="chapter" data-level="7.1.5" data-path="models-with-a-single-continuous-x.html"><a href="models-with-a-single-continuous-x.html#using-a-linear-model-for-explanation-causal-models"><i class="fa fa-check"></i><b>7.1.5</b> Using a linear model for “explanation” – causal models</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="models-with-a-single-continuous-x.html"><a href="models-with-a-single-continuous-x.html#working-in-r-1"><i class="fa fa-check"></i><b>7.2</b> Working in R</a><ul>
<li class="chapter" data-level="7.2.1" data-path="models-with-a-single-continuous-x.html"><a href="models-with-a-single-continuous-x.html#fitting-the-linear-model"><i class="fa fa-check"></i><b>7.2.1</b> Fitting the linear model</a></li>
<li class="chapter" data-level="7.2.2" data-path="models-with-a-single-continuous-x.html"><a href="models-with-a-single-continuous-x.html#getting-to-know-the-linear-model-the-summary-function"><i class="fa fa-check"></i><b>7.2.2</b> Getting to know the linear model: the <code>summary</code> function</a></li>
<li class="chapter" data-level="7.2.3" data-path="models-with-a-single-continuous-x.html"><a href="models-with-a-single-continuous-x.html#inference-the-coefficient-table-and-confidence-intervals"><i class="fa fa-check"></i><b>7.2.3</b> Inference – the coefficient table and Confidence intervals</a></li>
<li class="chapter" data-level="7.2.4" data-path="models-with-a-single-continuous-x.html"><a href="models-with-a-single-continuous-x.html#how-good-is-our-model"><i class="fa fa-check"></i><b>7.2.4</b> How good is our model?</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="a-linear-model-with-a-single-categorical-x.html"><a href="a-linear-model-with-a-single-categorical-x.html"><i class="fa fa-check"></i><b>8</b> A linear model with a single, categorical <em>X</em></a><ul>
<li class="chapter" data-level="8.1" data-path="a-linear-model-with-a-single-categorical-x.html"><a href="a-linear-model-with-a-single-categorical-x.html#a-linear-model-with-a-single-categorical-x-estimates-the-effects-of-x-on-the-response."><i class="fa fa-check"></i><b>8.1</b> A linear model with a single, categorical <em>X</em> estimates the effects of <em>X</em> on the response.</a><ul>
<li class="chapter" data-level="8.1.1" data-path="a-linear-model-with-a-single-categorical-x.html"><a href="a-linear-model-with-a-single-categorical-x.html#table-of-model-coefficients"><i class="fa fa-check"></i><b>8.1.1</b> Table of model coefficients</a></li>
<li class="chapter" data-level="8.1.2" data-path="a-linear-model-with-a-single-categorical-x.html"><a href="a-linear-model-with-a-single-categorical-x.html#the-linear-model"><i class="fa fa-check"></i><b>8.1.2</b> The linear model</a></li>
<li class="chapter" data-level="8.1.3" data-path="a-linear-model-with-a-single-categorical-x.html"><a href="a-linear-model-with-a-single-categorical-x.html#reporting-results"><i class="fa fa-check"></i><b>8.1.3</b> Reporting results</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="a-linear-model-with-a-single-categorical-x.html"><a href="a-linear-model-with-a-single-categorical-x.html#comparing-the-results-of-a-linear-model-to-classical-hypothesis-tests"><i class="fa fa-check"></i><b>8.2</b> Comparing the results of a linear model to classical hypothesis tests</a><ul>
<li class="chapter" data-level="8.2.1" data-path="a-linear-model-with-a-single-categorical-x.html"><a href="a-linear-model-with-a-single-categorical-x.html#t-tests-are-special-cases-of-a-linear-model"><i class="fa fa-check"></i><b>8.2.1</b> t-tests are special cases of a linear model</a></li>
<li class="chapter" data-level="8.2.2" data-path="a-linear-model-with-a-single-categorical-x.html"><a href="a-linear-model-with-a-single-categorical-x.html#anova-is-a-special-case-of-a-linear-model"><i class="fa fa-check"></i><b>8.2.2</b> ANOVA is a special case of a linear model</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="a-linear-model-with-a-single-categorical-x.html"><a href="a-linear-model-with-a-single-categorical-x.html#working-in-r-2"><i class="fa fa-check"></i><b>8.3</b> Working in R</a><ul>
<li class="chapter" data-level="8.3.1" data-path="a-linear-model-with-a-single-categorical-x.html"><a href="a-linear-model-with-a-single-categorical-x.html#fitting-the-model-1"><i class="fa fa-check"></i><b>8.3.1</b> Fitting the model</a></li>
<li class="chapter" data-level="8.3.2" data-path="a-linear-model-with-a-single-categorical-x.html"><a href="a-linear-model-with-a-single-categorical-x.html#changing-the-reference-level"><i class="fa fa-check"></i><b>8.3.2</b> Changing the reference level</a></li>
<li class="chapter" data-level="8.3.3" data-path="a-linear-model-with-a-single-categorical-x.html"><a href="a-linear-model-with-a-single-categorical-x.html#an-introduction-to-contrasts"><i class="fa fa-check"></i><b>8.3.3</b> An introduction to contrasts</a></li>
<li class="chapter" data-level="8.3.4" data-path="a-linear-model-with-a-single-categorical-x.html"><a href="a-linear-model-with-a-single-categorical-x.html#harrell-plot"><i class="fa fa-check"></i><b>8.3.4</b> Harrell plot</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="model-checking.html"><a href="model-checking.html"><i class="fa fa-check"></i><b>9</b> Model Checking</a><ul>
<li class="chapter" data-level="9.1" data-path="model-checking.html"><a href="model-checking.html#do-coefficients-make-numeric-sense"><i class="fa fa-check"></i><b>9.1</b> Do coefficients make numeric sense?</a></li>
<li class="chapter" data-level="9.2" data-path="model-checking.html"><a href="model-checking.html#all-statistical-analyses-should-be-followed-by-model-checking"><i class="fa fa-check"></i><b>9.2</b> All statistical analyses should be followed by model checking</a></li>
<li class="chapter" data-level="9.3" data-path="model-checking.html"><a href="model-checking.html#linear-model-assumptions"><i class="fa fa-check"></i><b>9.3</b> Linear model assumptions</a></li>
<li class="chapter" data-level="9.4" data-path="model-checking.html"><a href="model-checking.html#diagnostic-plots-use-the-residuals-from-the-model-fit"><i class="fa fa-check"></i><b>9.4</b> Diagnostic plots use the residuals from the model fit</a><ul>
<li class="chapter" data-level="9.4.1" data-path="model-checking.html"><a href="model-checking.html#residuals"><i class="fa fa-check"></i><b>9.4.1</b> Residuals</a></li>
<li class="chapter" data-level="9.4.2" data-path="model-checking.html"><a href="model-checking.html#a-normal-q-q-plot-is-used-to-check-normality"><i class="fa fa-check"></i><b>9.4.2</b> A Normal Q-Q plot is used to check normality</a></li>
<li class="chapter" data-level="9.4.3" data-path="model-checking.html"><a href="model-checking.html#outliers---an-outlier-is-a-point-that-is-highly-unexpected-given-the-modeled-distribution."><i class="fa fa-check"></i><b>9.4.3</b> Outliers - an outlier is a point that is highly unexpected given the modeled distribution.</a></li>
</ul></li>
<li class="chapter" data-level="9.5" data-path="model-checking.html"><a href="model-checking.html#model-checking-homoskedasticity"><i class="fa fa-check"></i><b>9.5</b> Model checking homoskedasticity</a></li>
<li class="chapter" data-level="9.6" data-path="model-checking.html"><a href="model-checking.html#model-checking-independence---hapiness-adverse-example."><i class="fa fa-check"></i><b>9.6</b> Model checking independence - hapiness adverse example.</a></li>
<li class="chapter" data-level="9.7" data-path="model-checking.html"><a href="model-checking.html#using-r"><i class="fa fa-check"></i><b>9.7</b> Using R</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="model-fitting-and-model-fit-ols.html"><a href="model-fitting-and-model-fit-ols.html"><i class="fa fa-check"></i><b>10</b> Model Fitting and Model Fit (OLS)</a><ul>
<li class="chapter" data-level="10.1" data-path="model-fitting-and-model-fit-ols.html"><a href="model-fitting-and-model-fit-ols.html#least-squares-estimation-and-the-decomposition-of-variance"><i class="fa fa-check"></i><b>10.1</b> Least Squares Estimation and the Decomposition of Variance</a></li>
<li class="chapter" data-level="10.2" data-path="model-fitting-and-model-fit-ols.html"><a href="model-fitting-and-model-fit-ols.html#ols-regression"><i class="fa fa-check"></i><b>10.2</b> OLS regression</a></li>
<li class="chapter" data-level="10.3" data-path="model-fitting-and-model-fit-ols.html"><a href="model-fitting-and-model-fit-ols.html#how-well-does-the-model-fit-the-data-r2-and-variance-explained"><i class="fa fa-check"></i><b>10.3</b> How well does the model fit the data? <span class="math inline">\(R^2\)</span> and “variance explained”</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="best-practices-issues-in-inference.html"><a href="best-practices-issues-in-inference.html"><i class="fa fa-check"></i><b>11</b> Best Practices – Issues in Inference</a><ul>
<li class="chapter" data-level="11.1" data-path="best-practices-issues-in-inference.html"><a href="best-practices-issues-in-inference.html#power"><i class="fa fa-check"></i><b>11.1</b> Power</a><ul>
<li class="chapter" data-level="11.1.1" data-path="best-practices-issues-in-inference.html"><a href="best-practices-issues-in-inference.html#types-of-error"><i class="fa fa-check"></i><b>11.1.1</b> “Types” of Error</a></li>
</ul></li>
<li class="chapter" data-level="11.2" data-path="best-practices-issues-in-inference.html"><a href="best-practices-issues-in-inference.html#multiple-testing"><i class="fa fa-check"></i><b>11.2</b> multiple testing</a><ul>
<li class="chapter" data-level="11.2.1" data-path="best-practices-issues-in-inference.html"><a href="best-practices-issues-in-inference.html#some-background"><i class="fa fa-check"></i><b>11.2.1</b> Some background</a></li>
<li class="chapter" data-level="11.2.2" data-path="best-practices-issues-in-inference.html"><a href="best-practices-issues-in-inference.html#multiple-testing-working-in-r"><i class="fa fa-check"></i><b>11.2.2</b> Multiple testing – working in R</a></li>
<li class="chapter" data-level="11.2.3" data-path="best-practices-issues-in-inference.html"><a href="best-practices-issues-in-inference.html#false-discovery-rate"><i class="fa fa-check"></i><b>11.2.3</b> False Discovery Rate</a></li>
</ul></li>
<li class="chapter" data-level="11.3" data-path="best-practices-issues-in-inference.html"><a href="best-practices-issues-in-inference.html#difference-in-p-is-not-different"><i class="fa fa-check"></i><b>11.3</b> difference in p is not different</a></li>
<li class="chapter" data-level="11.4" data-path="best-practices-issues-in-inference.html"><a href="best-practices-issues-in-inference.html#inference-when-data-are-not-normal"><i class="fa fa-check"></i><b>11.4</b> Inference when data are not Normal</a><ul>
<li class="chapter" data-level="11.4.1" data-path="best-practices-issues-in-inference.html"><a href="best-practices-issues-in-inference.html#working-in-r-3"><i class="fa fa-check"></i><b>11.4.1</b> Working in R</a></li>
<li class="chapter" data-level="11.4.2" data-path="best-practices-issues-in-inference.html"><a href="best-practices-issues-in-inference.html#bootstrap-confidence-intervals"><i class="fa fa-check"></i><b>11.4.2</b> Bootstrap Confidence Intervals</a></li>
<li class="chapter" data-level="11.4.3" data-path="best-practices-issues-in-inference.html"><a href="best-practices-issues-in-inference.html#permutation-test"><i class="fa fa-check"></i><b>11.4.3</b> Permutation test</a></li>
<li class="chapter" data-level="11.4.4" data-path="best-practices-issues-in-inference.html"><a href="best-practices-issues-in-inference.html#non-parametric-tests"><i class="fa fa-check"></i><b>11.4.4</b> Non-parametric tests</a></li>
<li class="chapter" data-level="11.4.5" data-path="best-practices-issues-in-inference.html"><a href="best-practices-issues-in-inference.html#log-transformations"><i class="fa fa-check"></i><b>11.4.5</b> Log transformations</a></li>
<li class="chapter" data-level="11.4.6" data-path="best-practices-issues-in-inference.html"><a href="best-practices-issues-in-inference.html#performance-of-parametric-tests-and-alternatives"><i class="fa fa-check"></i><b>11.4.6</b> Performance of parametric tests and alternatives</a></li>
</ul></li>
<li class="chapter" data-level="11.5" data-path="best-practices-issues-in-inference.html"><a href="best-practices-issues-in-inference.html#max-vs.-mean"><i class="fa fa-check"></i><b>11.5</b> max vs. mean</a></li>
<li class="chapter" data-level="11.6" data-path="best-practices-issues-in-inference.html"><a href="best-practices-issues-in-inference.html#pre-post-normalization"><i class="fa fa-check"></i><b>11.6</b> pre-post, normalization</a></li>
</ul></li>
<li><a href="part-iv-more-than-one-x-multivariable-models.html#part-iv-more-than-one-x-multivariable-models">Part IV: More than one <span class="math inline">\(X\)</span> – Multivariable Models</a></li>
<li class="chapter" data-level="12" data-path="adding-covariates-to-a-linear-model.html"><a href="adding-covariates-to-a-linear-model.html"><i class="fa fa-check"></i><b>12</b> Adding covariates to a linear model</a><ul>
<li class="chapter" data-level="12.1" data-path="adding-covariates-to-a-linear-model.html"><a href="adding-covariates-to-a-linear-model.html#adding-covariates-can-increases-the-precision-of-the-effect-of-interest"><i class="fa fa-check"></i><b>12.1</b> Adding covariates can increases the precision of the effect of interest</a></li>
<li class="chapter" data-level="12.2" data-path="adding-covariates-to-a-linear-model.html"><a href="adding-covariates-to-a-linear-model.html#adding-covariates-can-decrease-prediction-error-in-predictive-models"><i class="fa fa-check"></i><b>12.2</b> Adding covariates can decrease prediction error in predictive models</a></li>
<li class="chapter" data-level="12.3" data-path="adding-covariates-to-a-linear-model.html"><a href="adding-covariates-to-a-linear-model.html#adding-covariates-can-reduce-bias-due-to-confounding-in-explanatory-models"><i class="fa fa-check"></i><b>12.3</b> Adding covariates can reduce bias due to confounding in explanatory models</a></li>
<li class="chapter" data-level="12.4" data-path="adding-covariates-to-a-linear-model.html"><a href="adding-covariates-to-a-linear-model.html#best-practices-1-a-pre-treatment-measure-of-the-response-should-be-a-covariate-and-not-subtracted-from-the-post-treatment-measure-regression-to-the-mean"><i class="fa fa-check"></i><b>12.4</b> Best practices 1: A pre-treatment measure of the response should be a covariate and not subtracted from the post-treatment measure (regression to the mean)</a><ul>
<li class="chapter" data-level="12.4.1" data-path="adding-covariates-to-a-linear-model.html"><a href="adding-covariates-to-a-linear-model.html#regression-to-the-mean-in-words"><i class="fa fa-check"></i><b>12.4.1</b> Regression to the mean in words</a></li>
<li class="chapter" data-level="12.4.2" data-path="adding-covariates-to-a-linear-model.html"><a href="adding-covariates-to-a-linear-model.html#regression-to-the-mean-in-pictures"><i class="fa fa-check"></i><b>12.4.2</b> Regression to the mean in pictures</a></li>
<li class="chapter" data-level="12.4.3" data-path="adding-covariates-to-a-linear-model.html"><a href="adding-covariates-to-a-linear-model.html#do-not-use-percent-change-believing-that-percents-account-for-effects-of-initial-weights"><i class="fa fa-check"></i><b>12.4.3</b> Do not use percent change, believing that percents account for effects of initial weights</a></li>
<li class="chapter" data-level="12.4.4" data-path="adding-covariates-to-a-linear-model.html"><a href="adding-covariates-to-a-linear-model.html#do-not-test-for-balance-of-baseline-measures"><i class="fa fa-check"></i><b>12.4.4</b> Do not “test for balance” of baseline measures</a></li>
</ul></li>
<li class="chapter" data-level="12.5" data-path="adding-covariates-to-a-linear-model.html"><a href="adding-covariates-to-a-linear-model.html#best-practices-2-use-a-covariate-instead-of-normalizing-a-response"><i class="fa fa-check"></i><b>12.5</b> Best practices 2: Use a covariate instead of normalizing a response</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="two-or-more-categorical-x-factorial-designs.html"><a href="two-or-more-categorical-x-factorial-designs.html"><i class="fa fa-check"></i><b>13</b> Two (or more) Categorical <span class="math inline">\(X\)</span> – Factorial designs</a><ul>
<li class="chapter" data-level="13.1" data-path="two-or-more-categorical-x-factorial-designs.html"><a href="two-or-more-categorical-x-factorial-designs.html#factorial-experiments"><i class="fa fa-check"></i><b>13.1</b> Factorial experiments</a><ul>
<li class="chapter" data-level="13.1.1" data-path="two-or-more-categorical-x-factorial-designs.html"><a href="two-or-more-categorical-x-factorial-designs.html#model-coefficients-an-interaction-effect-is-what-is-leftover-after-adding-the-treatment-effects-to-the-control"><i class="fa fa-check"></i><b>13.1.1</b> Model coefficients: an interaction effect is what is leftover after adding the treatment effects to the control</a></li>
<li class="chapter" data-level="13.1.2" data-path="two-or-more-categorical-x-factorial-designs.html"><a href="two-or-more-categorical-x-factorial-designs.html#what-is-the-biological-meaning-of-an-interaction-effect"><i class="fa fa-check"></i><b>13.1.2</b> What is the biological meaning of an interaction effect?</a></li>
<li class="chapter" data-level="13.1.3" data-path="two-or-more-categorical-x-factorial-designs.html"><a href="two-or-more-categorical-x-factorial-designs.html#the-interpretation-of-the-coefficients-in-a-factorial-model-is-entirely-dependent-on-the-reference"><i class="fa fa-check"></i><b>13.1.3</b> The interpretation of the coefficients in a factorial model is entirely dependent on the reference…</a></li>
<li class="chapter" data-level="13.1.4" data-path="two-or-more-categorical-x-factorial-designs.html"><a href="two-or-more-categorical-x-factorial-designs.html#estimated-marginal-means"><i class="fa fa-check"></i><b>13.1.4</b> Estimated marginal means</a></li>
<li class="chapter" data-level="13.1.5" data-path="two-or-more-categorical-x-factorial-designs.html"><a href="two-or-more-categorical-x-factorial-designs.html#in-a-factorial-model-there-are-multiple-effects-of-each-factor-simple-effects"><i class="fa fa-check"></i><b>13.1.5</b> In a factorial model, there are multiple effects of each factor (simple effects)</a></li>
<li class="chapter" data-level="13.1.6" data-path="two-or-more-categorical-x-factorial-designs.html"><a href="two-or-more-categorical-x-factorial-designs.html#marginal-effects"><i class="fa fa-check"></i><b>13.1.6</b> Marginal effects</a></li>
<li class="chapter" data-level="13.1.7" data-path="two-or-more-categorical-x-factorial-designs.html"><a href="two-or-more-categorical-x-factorial-designs.html#the-additive-model"><i class="fa fa-check"></i><b>13.1.7</b> The additive model</a></li>
<li class="chapter" data-level="13.1.8" data-path="two-or-more-categorical-x-factorial-designs.html"><a href="two-or-more-categorical-x-factorial-designs.html#reduce-models-for-the-right-reason"><i class="fa fa-check"></i><b>13.1.8</b> Reduce models for the right reason</a></li>
<li class="chapter" data-level="13.1.9" data-path="two-or-more-categorical-x-factorial-designs.html"><a href="two-or-more-categorical-x-factorial-designs.html#what-about-models-with-more-than-two-factors"><i class="fa fa-check"></i><b>13.1.9</b> What about models with more than two factors?</a></li>
</ul></li>
<li class="chapter" data-level="13.2" data-path="two-or-more-categorical-x-factorial-designs.html"><a href="two-or-more-categorical-x-factorial-designs.html#reporting-results-1"><i class="fa fa-check"></i><b>13.2</b> Reporting results</a><ul>
<li class="chapter" data-level="13.2.1" data-path="two-or-more-categorical-x-factorial-designs.html"><a href="two-or-more-categorical-x-factorial-designs.html#text-results"><i class="fa fa-check"></i><b>13.2.1</b> Text results</a></li>
</ul></li>
<li class="chapter" data-level="13.3" data-path="two-or-more-categorical-x-factorial-designs.html"><a href="two-or-more-categorical-x-factorial-designs.html#working-in-r-4"><i class="fa fa-check"></i><b>13.3</b> Working in R</a><ul>
<li class="chapter" data-level="13.3.1" data-path="two-or-more-categorical-x-factorial-designs.html"><a href="two-or-more-categorical-x-factorial-designs.html#model-formula"><i class="fa fa-check"></i><b>13.3.1</b> Model formula</a></li>
<li class="chapter" data-level="13.3.2" data-path="two-or-more-categorical-x-factorial-designs.html"><a href="two-or-more-categorical-x-factorial-designs.html#modeled-means"><i class="fa fa-check"></i><b>13.3.2</b> Modeled means</a></li>
<li class="chapter" data-level="13.3.3" data-path="two-or-more-categorical-x-factorial-designs.html"><a href="two-or-more-categorical-x-factorial-designs.html#marginal-means"><i class="fa fa-check"></i><b>13.3.3</b> Marginal means</a></li>
<li class="chapter" data-level="13.3.4" data-path="two-or-more-categorical-x-factorial-designs.html"><a href="two-or-more-categorical-x-factorial-designs.html#contrasts"><i class="fa fa-check"></i><b>13.3.4</b> Contrasts</a></li>
<li class="chapter" data-level="13.3.5" data-path="two-or-more-categorical-x-factorial-designs.html"><a href="two-or-more-categorical-x-factorial-designs.html#simple-effects"><i class="fa fa-check"></i><b>13.3.5</b> Simple effects</a></li>
<li class="chapter" data-level="13.3.6" data-path="two-or-more-categorical-x-factorial-designs.html"><a href="two-or-more-categorical-x-factorial-designs.html#marginal-effects-1"><i class="fa fa-check"></i><b>13.3.6</b> Marginal effects</a></li>
<li class="chapter" data-level="13.3.7" data-path="two-or-more-categorical-x-factorial-designs.html"><a href="two-or-more-categorical-x-factorial-designs.html#plotting-results"><i class="fa fa-check"></i><b>13.3.7</b> Plotting results</a></li>
</ul></li>
<li class="chapter" data-level="13.4" data-path="two-or-more-categorical-x-factorial-designs.html"><a href="two-or-more-categorical-x-factorial-designs.html#problems-1"><i class="fa fa-check"></i><b>13.4</b> Problems</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="anova-tables.html"><a href="anova-tables.html"><i class="fa fa-check"></i><b>14</b> ANOVA Tables</a><ul>
<li class="chapter" data-level="14.1" data-path="anova-tables.html"><a href="anova-tables.html#summary-of-usage"><i class="fa fa-check"></i><b>14.1</b> Summary of usage</a></li>
<li class="chapter" data-level="14.2" data-path="anova-tables.html"><a href="anova-tables.html#example-a-one-way-anova-using-the-vole-data"><i class="fa fa-check"></i><b>14.2</b> Example: a one-way ANOVA using the vole data</a></li>
<li class="chapter" data-level="14.3" data-path="anova-tables.html"><a href="anova-tables.html#example-a-two-way-anova-using-the-urchin-data"><i class="fa fa-check"></i><b>14.3</b> Example: a two-way ANOVA using the urchin data</a><ul>
<li class="chapter" data-level="14.3.1" data-path="anova-tables.html"><a href="anova-tables.html#how-to-read-an-anova-table"><i class="fa fa-check"></i><b>14.3.1</b> How to read an ANOVA table</a></li>
<li class="chapter" data-level="14.3.2" data-path="anova-tables.html"><a href="anova-tables.html#how-to-read-anova-results-reported-in-the-text"><i class="fa fa-check"></i><b>14.3.2</b> How to read ANOVA results reported in the text</a></li>
<li class="chapter" data-level="14.3.3" data-path="anova-tables.html"><a href="anova-tables.html#better-practice-estimates-and-their-uncertainty"><i class="fa fa-check"></i><b>14.3.3</b> Better practice – estimates and their uncertainty</a></li>
</ul></li>
<li class="chapter" data-level="14.4" data-path="anova-tables.html"><a href="anova-tables.html#unbalanced-designs"><i class="fa fa-check"></i><b>14.4</b> Unbalanced designs</a><ul>
<li class="chapter" data-level="14.4.1" data-path="anova-tables.html"><a href="anova-tables.html#what-is-going-on-in-unbalanced-anova-type-i-ii-iii-sum-of-squares"><i class="fa fa-check"></i><b>14.4.1</b> What is going on in unbalanced ANOVA? – Type I, II, III sum of squares</a></li>
<li class="chapter" data-level="14.4.2" data-path="anova-tables.html"><a href="anova-tables.html#back-to-interpretation-of-main-effects"><i class="fa fa-check"></i><b>14.4.2</b> Back to interpretation of main effects</a></li>
<li class="chapter" data-level="14.4.3" data-path="anova-tables.html"><a href="anova-tables.html#the-anova-tables-for-type-i-ii-and-iii-sum-of-squares-are-the-same-if-the-design-is-balanced."><i class="fa fa-check"></i><b>14.4.3</b> The anova tables for Type I, II, and III sum of squares are the same if the design is balanced.</a></li>
</ul></li>
<li class="chapter" data-level="14.5" data-path="anova-tables.html"><a href="anova-tables.html#working-in-r-5"><i class="fa fa-check"></i><b>14.5</b> Working in R</a><ul>
<li class="chapter" data-level="14.5.1" data-path="anova-tables.html"><a href="anova-tables.html#type-i-sum-of-squares-in-r"><i class="fa fa-check"></i><b>14.5.1</b> Type I sum of squares in R</a></li>
<li class="chapter" data-level="14.5.2" data-path="anova-tables.html"><a href="anova-tables.html#type-ii-and-iii-sum-of-squares"><i class="fa fa-check"></i><b>14.5.2</b> Type II and III Sum of Squares</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="15" data-path="predictive-models.html"><a href="predictive-models.html"><i class="fa fa-check"></i><b>15</b> Predictive Models</a><ul>
<li class="chapter" data-level="15.1" data-path="predictive-models.html"><a href="predictive-models.html#overfitting"><i class="fa fa-check"></i><b>15.1</b> Overfitting</a></li>
<li class="chapter" data-level="15.2" data-path="predictive-models.html"><a href="predictive-models.html#model-building-vs.-variable-selection-vs.-model-selection"><i class="fa fa-check"></i><b>15.2</b> Model building vs. Variable selection vs. Model selection</a><ul>
<li class="chapter" data-level="15.2.1" data-path="predictive-models.html"><a href="predictive-models.html#stepwise-regression"><i class="fa fa-check"></i><b>15.2.1</b> Stepwise regression</a></li>
<li class="chapter" data-level="15.2.2" data-path="predictive-models.html"><a href="predictive-models.html#cross-validation"><i class="fa fa-check"></i><b>15.2.2</b> Cross-validation</a></li>
<li class="chapter" data-level="15.2.3" data-path="predictive-models.html"><a href="predictive-models.html#penalization"><i class="fa fa-check"></i><b>15.2.3</b> Penalization</a></li>
</ul></li>
<li class="chapter" data-level="15.3" data-path="predictive-models.html"><a href="predictive-models.html#shrinkage"><i class="fa fa-check"></i><b>15.3</b> Shrinkage</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="part-v-expanding-the-linear-model-generalized-linear-models-and-multilevel-linear-mixed-models.html"><a href="part-v-expanding-the-linear-model-generalized-linear-models-and-multilevel-linear-mixed-models.html"><i class="fa fa-check"></i>Part V: Expanding the Linear Model – Generalized Linear Models and Multilevel (Linear Mixed) Models</a></li>
<li class="chapter" data-level="16" data-path="linear-mixed-models.html"><a href="linear-mixed-models.html"><i class="fa fa-check"></i><b>16</b> Linear mixed models</a><ul>
<li class="chapter" data-level="16.1" data-path="linear-mixed-models.html"><a href="linear-mixed-models.html#random-effects"><i class="fa fa-check"></i><b>16.1</b> Random effects</a></li>
<li class="chapter" data-level="16.2" data-path="linear-mixed-models.html"><a href="linear-mixed-models.html#random-effects-in-statistical-models"><i class="fa fa-check"></i><b>16.2</b> Random effects in statistical models</a></li>
<li class="chapter" data-level="16.3" data-path="linear-mixed-models.html"><a href="linear-mixed-models.html#linear-mixed-models-are-flexible"><i class="fa fa-check"></i><b>16.3</b> Linear mixed models are flexible</a></li>
<li class="chapter" data-level="16.4" data-path="linear-mixed-models.html"><a href="linear-mixed-models.html#blocking"><i class="fa fa-check"></i><b>16.4</b> Blocking</a><ul>
<li class="chapter" data-level="16.4.1" data-path="linear-mixed-models.html"><a href="linear-mixed-models.html#visualing-variation-due-to-blocks"><i class="fa fa-check"></i><b>16.4.1</b> Visualing variation due to blocks</a></li>
<li class="chapter" data-level="16.4.2" data-path="linear-mixed-models.html"><a href="linear-mixed-models.html#blocking-increases-precision-of-point-estimates"><i class="fa fa-check"></i><b>16.4.2</b> Blocking increases precision of point estimates</a></li>
</ul></li>
<li class="chapter" data-level="16.5" data-path="linear-mixed-models.html"><a href="linear-mixed-models.html#pseudoreplication"><i class="fa fa-check"></i><b>16.5</b> Pseudoreplication</a><ul>
<li class="chapter" data-level="16.5.1" data-path="linear-mixed-models.html"><a href="linear-mixed-models.html#visualizing-pseduoreplication"><i class="fa fa-check"></i><b>16.5.1</b> Visualizing pseduoreplication</a></li>
</ul></li>
<li class="chapter" data-level="16.6" data-path="linear-mixed-models.html"><a href="linear-mixed-models.html#mapping-nhst-to-estimation-a-paired-t-test-is-a-special-case-of-a-linear-mixed-model"><i class="fa fa-check"></i><b>16.6</b> Mapping NHST to estimation: A paired t-test is a special case of a linear mixed model</a></li>
<li class="chapter" data-level="16.7" data-path="linear-mixed-models.html"><a href="linear-mixed-models.html#advanced-topic-linear-mixed-models-shrink-coefficients-by-partial-pooling"><i class="fa fa-check"></i><b>16.7</b> Advanced topic – Linear mixed models shrink coefficients by partial pooling</a></li>
<li class="chapter" data-level="16.8" data-path="linear-mixed-models.html"><a href="linear-mixed-models.html#working-in-r-6"><i class="fa fa-check"></i><b>16.8</b> Working in R</a><ul>
<li class="chapter" data-level="16.8.1" data-path="linear-mixed-models.html"><a href="linear-mixed-models.html#coral-data"><i class="fa fa-check"></i><b>16.8.1</b> coral data</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="17" data-path="generalized-linear-models-i-count-data.html"><a href="generalized-linear-models-i-count-data.html"><i class="fa fa-check"></i><b>17</b> Generalized linear models I: Count data</a><ul>
<li class="chapter" data-level="17.1" data-path="generalized-linear-models-i-count-data.html"><a href="generalized-linear-models-i-count-data.html#the-generalized-linear-model"><i class="fa fa-check"></i><b>17.1</b> The generalized linear model</a></li>
<li class="chapter" data-level="17.2" data-path="generalized-linear-models-i-count-data.html"><a href="generalized-linear-models-i-count-data.html#count-data-example-number-of-trematode-worm-larvae-in-eyes-of-threespine-stickleback-fish"><i class="fa fa-check"></i><b>17.2</b> Count data example – number of trematode worm larvae in eyes of threespine stickleback fish</a><ul>
<li class="chapter" data-level="17.2.1" data-path="generalized-linear-models-i-count-data.html"><a href="generalized-linear-models-i-count-data.html#modeling-strategy-1"><i class="fa fa-check"></i><b>17.2.1</b> Modeling strategy</a></li>
<li class="chapter" data-level="17.2.2" data-path="generalized-linear-models-i-count-data.html"><a href="generalized-linear-models-i-count-data.html#checking-the-model-i-a-normal-q-q-plot"><i class="fa fa-check"></i><b>17.2.2</b> Checking the model I – a Normal Q-Q plot</a></li>
<li class="chapter" data-level="17.2.3" data-path="generalized-linear-models-i-count-data.html"><a href="generalized-linear-models-i-count-data.html#checking-the-model-ii-scale-location-plot-for-checking-homoskedasticity"><i class="fa fa-check"></i><b>17.2.3</b> Checking the model II – scale-location plot for checking homoskedasticity</a></li>
<li class="chapter" data-level="17.2.4" data-path="generalized-linear-models-i-count-data.html"><a href="generalized-linear-models-i-count-data.html#two-distributions-for-count-data-poisson-and-negative-binomial"><i class="fa fa-check"></i><b>17.2.4</b> Two distributions for count data – Poisson and Negative Binomial</a></li>
<li class="chapter" data-level="17.2.5" data-path="generalized-linear-models-i-count-data.html"><a href="generalized-linear-models-i-count-data.html#fitting-a-glm-with-a-poisson-distribution-to-the-worm-data"><i class="fa fa-check"></i><b>17.2.5</b> Fitting a GLM with a Poisson distribution to the worm data</a></li>
<li class="chapter" data-level="17.2.6" data-path="generalized-linear-models-i-count-data.html"><a href="generalized-linear-models-i-count-data.html#model-checking-fits-to-count-data"><i class="fa fa-check"></i><b>17.2.6</b> Model checking fits to count data</a></li>
<li class="chapter" data-level="17.2.7" data-path="generalized-linear-models-i-count-data.html"><a href="generalized-linear-models-i-count-data.html#fitting-a-glm-with-a-negative-binomial-distribution-to-the-worm-data"><i class="fa fa-check"></i><b>17.2.7</b> Fitting a GLM with a Negative Binomial distribution to the worm data</a></li>
</ul></li>
<li class="chapter" data-level="17.3" data-path="generalized-linear-models-i-count-data.html"><a href="generalized-linear-models-i-count-data.html#working-in-r-7"><i class="fa fa-check"></i><b>17.3</b> Working in R</a><ul>
<li class="chapter" data-level="17.3.1" data-path="generalized-linear-models-i-count-data.html"><a href="generalized-linear-models-i-count-data.html#fitting-a-glm-to-count-data"><i class="fa fa-check"></i><b>17.3.1</b> Fitting a GLM to count data</a></li>
<li class="chapter" data-level="17.3.2" data-path="generalized-linear-models-i-count-data.html"><a href="generalized-linear-models-i-count-data.html#fitting-a-generalized-linear-mixed-model-glmm-to-count-data"><i class="fa fa-check"></i><b>17.3.2</b> Fitting a generalized linear mixed model (GLMM) to count data</a></li>
<li class="chapter" data-level="17.3.3" data-path="generalized-linear-models-i-count-data.html"><a href="generalized-linear-models-i-count-data.html#fitting-a-generalized-linear-model-to-continouus-data"><i class="fa fa-check"></i><b>17.3.3</b> Fitting a generalized linear model to continouus data</a></li>
</ul></li>
<li class="chapter" data-level="17.4" data-path="generalized-linear-models-i-count-data.html"><a href="generalized-linear-models-i-count-data.html#problems-2"><i class="fa fa-check"></i><b>17.4</b> Problems</a></li>
</ul></li>
<li class="chapter" data-level="18" data-path="linear-models-with-heterogenous-variance.html"><a href="linear-models-with-heterogenous-variance.html"><i class="fa fa-check"></i><b>18</b> Linear models with heterogenous variance</a><ul>
<li class="chapter" data-level="18.1" data-path="linear-models-with-heterogenous-variance.html"><a href="linear-models-with-heterogenous-variance.html#gls"><i class="fa fa-check"></i><b>18.1</b> gls</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="appendix-1-getting-started-with-r.html"><a href="appendix-1-getting-started-with-r.html"><i class="fa fa-check"></i>Appendix 1: Getting Started with R</a><ul>
<li class="chapter" data-level="18.2" data-path="appendix-1-getting-started-with-r.html"><a href="appendix-1-getting-started-with-r.html#get-your-computer-ready"><i class="fa fa-check"></i><b>18.2</b> Get your computer ready</a><ul>
<li class="chapter" data-level="18.2.1" data-path="appendix-1-getting-started-with-r.html"><a href="appendix-1-getting-started-with-r.html#install-r"><i class="fa fa-check"></i><b>18.2.1</b> Install R</a></li>
<li class="chapter" data-level="18.2.2" data-path="appendix-1-getting-started-with-r.html"><a href="appendix-1-getting-started-with-r.html#install-r-studio"><i class="fa fa-check"></i><b>18.2.2</b> Install R Studio</a></li>
<li class="chapter" data-level="18.2.3" data-path="appendix-1-getting-started-with-r.html"><a href="appendix-1-getting-started-with-r.html#resources-for-installing-r-and-r-studio"><i class="fa fa-check"></i><b>18.2.3</b> Resources for installing R and R Studio</a></li>
<li class="chapter" data-level="18.2.4" data-path="appendix-1-getting-started-with-r.html"><a href="appendix-1-getting-started-with-r.html#install-latex"><i class="fa fa-check"></i><b>18.2.4</b> Install LaTeX</a></li>
</ul></li>
<li class="chapter" data-level="18.3" data-path="appendix-1-getting-started-with-r.html"><a href="appendix-1-getting-started-with-r.html#start-learning"><i class="fa fa-check"></i><b>18.3</b> Start learning</a><ul>
<li class="chapter" data-level="18.3.1" data-path="appendix-1-getting-started-with-r.html"><a href="appendix-1-getting-started-with-r.html#start-with-data-camp-introduction-to-r"><i class="fa fa-check"></i><b>18.3.1</b> Start with Data Camp Introduction to R</a></li>
<li class="chapter" data-level="18.3.2" data-path="appendix-1-getting-started-with-r.html"><a href="appendix-1-getting-started-with-r.html#then-move-to-introduction-to-r-studio"><i class="fa fa-check"></i><b>18.3.2</b> Then Move to Introduction to R Studio</a></li>
<li class="chapter" data-level="18.3.3" data-path="appendix-1-getting-started-with-r.html"><a href="appendix-1-getting-started-with-r.html#develop-your-project-with-an-r-studio-notebook"><i class="fa fa-check"></i><b>18.3.3</b> Develop your project with an R Studio Notebook</a></li>
</ul></li>
<li class="chapter" data-level="18.4" data-path="appendix-1-getting-started-with-r.html"><a href="appendix-1-getting-started-with-r.html#getting-data-into-r"><i class="fa fa-check"></i><b>18.4</b> Getting Data into R</a></li>
<li class="chapter" data-level="18.5" data-path="appendix-1-getting-started-with-r.html"><a href="appendix-1-getting-started-with-r.html#additional-r-learning-resources"><i class="fa fa-check"></i><b>18.5</b> Additional R learning resources</a></li>
<li class="chapter" data-level="18.6" data-path="appendix-1-getting-started-with-r.html"><a href="appendix-1-getting-started-with-r.html#packages-used-extensively-in-this-text"><i class="fa fa-check"></i><b>18.6</b> Packages used extensively in this text</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="appendix-2-online-resources-for-getting-started-with-statistical-modeling-in-r.html"><a href="appendix-2-online-resources-for-getting-started-with-statistical-modeling-in-r.html"><i class="fa fa-check"></i>Appendix 2: Online Resources for Getting Started with Statistical Modeling in R</a></li>
<li class="chapter" data-level="" data-path="appendix-3-fake-data-simulations.html"><a href="appendix-3-fake-data-simulations.html"><i class="fa fa-check"></i>Appendix 3: Fake Data Simulations</a><ul>
<li class="chapter" data-level="18.7" data-path="appendix-3-fake-data-simulations.html"><a href="appendix-3-fake-data-simulations.html#performance-of-blocking-relative-to-a-linear-model"><i class="fa fa-check"></i><b>18.7</b> Performance of Blocking relative to a linear model</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Elements of Statistical Modeling for Experimental Biology</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="data-reading-wrangling-and-writing" class="section level1">
<h1><span class="header-section-number">Chapter 2</span> Data – Reading, Wrangling, and Writing</h1>
<p>Importing data into R can be a struggle for new R users and, unfortunately, most online “how to import” sources give easy but superficial methods that don’t follow best practices for increasing reproducibility or do not allow flexible organization of files within a project. Go straight to (Working in R)[data-working-in-r] if you just want to learn the method used to import files in this text and don’t care about important background information.</p>
<p>Some examples:</p>
<ol style="list-style-type: decimal">
<li><code>df &lt;- read.table(file="clipboard")</code> imports data copied to the clipboard, from an Excel/Sheets file or from an open text file. For this to be semi-reproducible, a comment specifying the filename, worksheet and range that was copied is necessary. More problematic (catastrophically so for reproducibility), is, how does a researcher know that they highlighted and copied the correct range in the Excel sheet?</li>
<li><code>df &lt;- read.csv(file.choose())</code> opens the familiar “open file” dialog box, which lets the user navigate to the file of choice. For this to be semi-reproducible, a comment specifying the filename to import is necessary. The catastrophic problem (for reproducibility) is, how does a researcher know which file was actually opened during an R session? The researcher might think they opened “walker_maine_bee_data_clean_androscoggin.csv” but mistakenly opened “walker_maine_bee_data_clean_aroostook.csv”.</li>
<li><code>df &lt;- read.table(file="my_data.txt")</code> and <code>df &lt;- read_excel(file="my_data.xlsx")</code> are reproducible because the filename is explicitly specified. But, this method requires that “my_data” is physically located in the same folder as the file containing the R script (the notebook .Rmd file in our case) and this violates the best practice of clean project organization with different folders for the different kinds of files (data, R scripts, images, manuscript text, etc.).</li>
<li>R Studio has an elegant import tool in the environment pane that opens a custom dialog box that allows the researcher to navigate to the file, and to specify what part of the file to import, such as the specific sheet and range for an Excel file. This has the same reproducibility issues as #1 and #2 but R Studio includes the equivalent script, which adds all relevant information for reproducility. One then simply copies and pastes this script into a code chunk and voila! The next time the script is run, the data can be imported from the script without using menus and dialog boxes. Except that..the script does not seem to take into account that the <strong>working directory</strong> of an R Markdown file is not the project folder but the folder containing the R Markdown file and so this two-step method fails. More personally, I’d prefer to run a chunk that quickly opens the data file instead of re-navigating through my file system and re-specifying the sheet and range every time I re-start the project in a new R session.</li>
</ol>
<p>There are at least three solutions to the issues raised above, all requiring some understanding of <strong>file paths</strong> and directory structure in an operating system. A file such as “my_data.xlsx” has an <strong>absolute</strong> file path, which is the full address of the file (the filename is something like your house street number). The absolute file path of “my_data.xlsx” might be “/Users/jwalker/Documents/applied-biostatistics/data/my_data.xlsx”. A <strong>relative</strong> file path is the file path from the <strong>working directory</strong>. In an R Studio project, the working directory is the project directory, which is the directory containing the .Rproj file. This will be the working directory of the console. <em>Importantly</em>, the working directory of an R Markdown code chunk is the folder containing the saved R Markdown file. An R Studio Notebook is an R Markdown file so the working directory of a notebook code chunk is the folder containing the saved notebook file. If a notebook file is located within the notebooks folder, which is located within the project folder, then the relative file path to “my_file.xlsx” is “../data/my_file.xlsx”. The “..” tells the file OS to move “up” into the parent directory (which is the project folder) and the “data” tells the file OS to move “down” into the data folder. These are put together into a single address using “/”. The beauty of relative paths is that they remain the same – and so do not break one’s script – if the project folder, and all of its contents including the data folder and the notebooks folder, is moved to another location on the hard drive (say into a new “Research” folder). By contrast, the absolute file path changes, which breaks any old script.</p>
<p>The three solutions are</p>
<ol style="list-style-type: decimal">
<li>Create a <strong>relative path</strong> to the file using something like <code>file_path &lt;- "../data/my_data.xlsx"</code>. This should <em>always</em> work but it fails on some computers. For example, if the project folder is on a Windows OS (but not Mac OS) desktop, the assigned relative address doesn’t seem to look in the folder containing the file.</li>
<li>Create a setup chunk that reroutes the working directory to the project folder using the script</li>
</ol>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="data-reading-wrangling-and-writing.html#cb5-1"></a><span class="co"># use this in a chuck called &quot;setup&quot; to force the working directory to be</span></span>
<span id="cb5-2"><a href="data-reading-wrangling-and-writing.html#cb5-2"></a><span class="co"># at the level of the project file.</span></span>
<span id="cb5-3"><a href="data-reading-wrangling-and-writing.html#cb5-3"></a>knitr<span class="op">::</span>opts_knit<span class="op">$</span><span class="kw">set</span>(<span class="dt">root.dir =</span> rprojroot<span class="op">::</span><span class="kw">find_rstudio_root_file</span>())</span></code></pre></div>
<p>For this to work, the chunk has to be named “setup”, that is, the text inside the curly brackets at the top of the chunk should be “r setup”. Then, with this chunk, the relative file path is <code>file_path &lt;- "../data/my_data.xlsx"</code> if “my_data.xlsx” is immediately inside the data folder which is immediately inside the project folder. This should work on any machine, and should work even if a project folder is moved.</p>
<ol start="3" style="list-style-type: decimal">
<li>Use the function here(). The most robust solution seems to be using the function here() from the here package. The function works something like this</li>
</ol>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="data-reading-wrangling-and-writing.html#cb6-1"></a>data_folder &lt;-<span class="st"> &quot;data&quot;</span> <span class="co"># path to data that are imported</span></span>
<span id="cb6-2"><a href="data-reading-wrangling-and-writing.html#cb6-2"></a>file_name &lt;-<span class="st"> &quot;my_data.xlsx&quot;</span></span>
<span id="cb6-3"><a href="data-reading-wrangling-and-writing.html#cb6-3"></a>file_path &lt;-<span class="st"> </span><span class="kw">here</span>(data_folder, file_name) <span class="co"># paste together parts of the address</span></span>
<span id="cb6-4"><a href="data-reading-wrangling-and-writing.html#cb6-4"></a>my_file &lt;-<span class="st"> </span><span class="kw">read_excel</span>(<span class="dt">file =</span> file_path)</span></code></pre></div>
<p><code>here()</code> creates an absolute path, but one that is created on the fly, and will change (or should change) correctly if the project folder is moved on the same machine or to another machine.</p>
<div id="learning-from-this-chapter" class="section level2">
<h2><span class="header-section-number">2.1</span> Learning from this chapter</h2>
<p>It will be easiest to learn from this chapter by starting with a clean notebook for the chapter. Create a new notebook and save it to the “notebooks” folder of your “applied biostats” project. <strong>Important:</strong> import/export scripts will not work properly until the file is saved! Get in the habit of creating the file, saving it immediately, and saving it often.</p>
<ol style="list-style-type: decimal">
<li>Delete everything after the YAML header (this is the section at the top bounded by the “—”.</li>
<li>Create a setup chunk that loads packages and creates variables for the locations of reading, writing, and image folders.</li>
</ol>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="data-reading-wrangling-and-writing.html#cb7-1"></a><span class="co"># import and wrangling packages</span></span>
<span id="cb7-2"><a href="data-reading-wrangling-and-writing.html#cb7-2"></a><span class="kw">library</span>(here) <span class="co"># here() creates the absolute path to the file</span></span>
<span id="cb7-3"><a href="data-reading-wrangling-and-writing.html#cb7-3"></a><span class="kw">library</span>(janitor) <span class="co"># clean_names to clean col labels of imported data</span></span>
<span id="cb7-4"><a href="data-reading-wrangling-and-writing.html#cb7-4"></a><span class="kw">library</span>(readxl) <span class="co"># import excel</span></span>
<span id="cb7-5"><a href="data-reading-wrangling-and-writing.html#cb7-5"></a><span class="kw">library</span>(data.table) <span class="co"># use data.table for wrangling</span></span>
<span id="cb7-6"><a href="data-reading-wrangling-and-writing.html#cb7-6"></a></span>
<span id="cb7-7"><a href="data-reading-wrangling-and-writing.html#cb7-7"></a><span class="co"># analysis packages</span></span>
<span id="cb7-8"><a href="data-reading-wrangling-and-writing.html#cb7-8"></a><span class="kw">library</span>(emmeans) <span class="co"># get estimated marginal means and CIs, used for plot</span></span>
<span id="cb7-9"><a href="data-reading-wrangling-and-writing.html#cb7-9"></a></span>
<span id="cb7-10"><a href="data-reading-wrangling-and-writing.html#cb7-10"></a><span class="co"># plotting packages</span></span>
<span id="cb7-11"><a href="data-reading-wrangling-and-writing.html#cb7-11"></a><span class="kw">library</span>(ggplot2) <span class="co"># ggplot environment</span></span>
<span id="cb7-12"><a href="data-reading-wrangling-and-writing.html#cb7-12"></a><span class="kw">library</span>(ggpubr) <span class="co"># publication ready plots</span></span>
<span id="cb7-13"><a href="data-reading-wrangling-and-writing.html#cb7-13"></a></span>
<span id="cb7-14"><a href="data-reading-wrangling-and-writing.html#cb7-14"></a>here &lt;-<span class="st"> </span>here<span class="op">::</span>here <span class="co"># make sure ``here` uses `here::here`</span></span>
<span id="cb7-15"><a href="data-reading-wrangling-and-writing.html#cb7-15"></a></span>
<span id="cb7-16"><a href="data-reading-wrangling-and-writing.html#cb7-16"></a><span class="co"># relative paths to project folders</span></span>
<span id="cb7-17"><a href="data-reading-wrangling-and-writing.html#cb7-17"></a>data_folder &lt;-<span class="st"> &quot;data&quot;</span> <span class="co"># path to data that are imported</span></span>
<span id="cb7-18"><a href="data-reading-wrangling-and-writing.html#cb7-18"></a>output_folder &lt;-<span class="st"> &quot;output&quot;</span> <span class="co"># path to data that are saved</span></span>
<span id="cb7-19"><a href="data-reading-wrangling-and-writing.html#cb7-19"></a>image_folder &lt;-<span class="st"> &quot;images&quot;</span></span></code></pre></div>
<p>Note on the script above
1. Be kind to the future you by loading only the packages necessary for the code in the R Markdown file that you are working on. If your default is to load everything, the future you will be confused why something was installed.
2. Be kind to the future you by commenting on why a package is loaded; usually this is a specific function from the package
3. <code>here &lt;- here::here</code> is my favorite script ever. What is it doing? One can read this as “assign the function here from the here package to the object here” (this is reading the script right to left). Why do this? It turns out the multiple packages define a function called “here”. If any of these packages are loaded after the here package, then <code>here</code> from here won’t work – it will be replaced by <code>here</code> from the more recently loaded package. To make sure that <code>here</code> uses the function from the here package, I simply reassign <code>here</code> from the here package to the object “here” <em>after</em> loading in all packages.</p>
</div>
<div id="data-working-in-r" class="section level2">
<h2><span class="header-section-number">2.2</span> Working in R</h2>
<div id="importing-data" class="section level3">
<h3><span class="header-section-number">2.2.1</span> Importing data</h3>
<div id="excel-file" class="section level4">
<h4><span class="header-section-number">2.2.1.1</span> Excel file</h4>
<p>The Excel dataset is from an experiment on the growth response of zebra finch chicks to an incubation call that presumably signals “hot environment” to the embryos (<a href="http://science.sciencemag.org/content/353/6301/812" target="_blank">Mariette, M.M. and Buchanan, K.L., 2016. Prenatal acoustic communication programs offspring for high posthatching temperatures in a songbird. Science, 353(6301), pp.812-814</a>). The source file is from the Dryad Repository here:</p>
<p><strong>file name</strong>: “allDatasetsMarietteBuchanan2016.xls”</p>
<p><strong>source</strong>: <a href="https://datadryad.org//handle/10255/dryad.122315" class="uri">https://datadryad.org//handle/10255/dryad.122315</a></p>
<p>Steps</p>
<ol style="list-style-type: decimal">
<li>Copy the title of the article, which is “Prenatal acoustic communication programs offspring for high post-hatching temperatures in a songbird”</li>
<li>Create a new folder within the “data” folder. Name the folder the title of the paper by pasting the name from the clipboard. This is the “data from” folder, since it contains the data from the publication with the title of the folder.</li>
<li>Download the .xls file into this folder</li>
</ol>
<p>A .xls file is an old (pre 2007) Microsoft Excel file type. It is a binary file and can only be opened into a readable format with software that knows how to translate the proprietary format. The more modern Excel file type is .xlsx, which contains within it multiple xml components. An xml file is a text file, and so contains readable content, but the content is xml code to display something. In general, I am a big advocate of archiving stuff as text files (manuscripts, data, scripts, blog posts) because these will <em>always</em> be readable by future software. Microsoft Excel is not likely to die anytime soon and software that can read .xls and especially .xlsx files (again, .xlsx files are text files) is even less likely to disappear but we can feel even more confident if data are archived as text files. That said, a single microsoft excel file with multiple sheets is an efficient method for distributing data and the readxl package provides excellent tools for reading different sheets of a single .xls or .xlsx file.</p>
<p>The code below uses the function <code>read_excel()</code> from the package readxl. More about the amazing power of this package is the <a href="https://readxl.tidyverse.org" target="_blank">tidyverse page</a> and <a href="http://r4ds.had.co.nz/data-import.html" target="_blank">chapter 11</a> in the <em>R for Data Science</em> book.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="data-reading-wrangling-and-writing.html#cb8-1"></a>folder &lt;-<span class="st"> &quot;Prenatal acoustic communication programs offspring for high post-hatching temperatures in a songbird&quot;</span></span>
<span id="cb8-2"><a href="data-reading-wrangling-and-writing.html#cb8-2"></a>fn &lt;-<span class="st"> &quot;allDatasetsMarietteBuchanan2016.xls&quot;</span></span>
<span id="cb8-3"><a href="data-reading-wrangling-and-writing.html#cb8-3"></a>file_path &lt;-<span class="st"> </span><span class="kw">here</span>(data_folder, folder, fn)</span>
<span id="cb8-4"><a href="data-reading-wrangling-and-writing.html#cb8-4"></a>chick &lt;-<span class="st"> </span><span class="kw">read_excel</span>(file_path, </span>
<span id="cb8-5"><a href="data-reading-wrangling-and-writing.html#cb8-5"></a>                    <span class="dt">sheet =</span> <span class="st">&quot;nestlingMass&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># import</span></span>
<span id="cb8-6"><a href="data-reading-wrangling-and-writing.html#cb8-6"></a><span class="st">  </span><span class="kw">clean_names</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># clean the column names</span></span>
<span id="cb8-7"><a href="data-reading-wrangling-and-writing.html#cb8-7"></a><span class="st">  </span><span class="kw">data.table</span>() <span class="co"># convert to data.table</span></span></code></pre></div>
<p>This text will consistently uses this protocol for storing and retrieving downloaded files. The first three lines in the script above creates the directory path to the file. This path includes three variables</p>
<ol style="list-style-type: decimal">
<li><code>data_folder</code> – assigned to “data” in the setup chunk. “data” is a folder within the project folder that contains (or will contain) all datasets for this text. The data come from many different published papers, so the data for each publication gets its own folder within “data”.</li>
<li><code>folder</code> – the name of the “data from” folder within “data” containing the data files. In this text, these folder names will always be the name of the published paper.</li>
<li><code>filename</code> – the name of the file to read. There may be multiple data files within the publication’s data folder.</li>
</ol>
<p>These are all put together into the absolute path using the function <code>here()</code> from the here package. Take a look at the value of file_path to confirm.</p>
<p>The last four lines (starting with <code>chick &lt;-</code>) contains three functions that are <strong>piped</strong> together using the pipe operator <code>%&gt;%</code>. These functions</p>
<ol style="list-style-type: decimal">
<li>read the specified data from the specified file and assign this to <code>chick</code></li>
<li>clean the column names of the data.frame</li>
<li>convert the data.frame to a data.table.</li>
</ol>
<p>There are multiple ways to do this exactly this, including</p>
<p>A copy of the code above, which uses pipes</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="data-reading-wrangling-and-writing.html#cb9-1"></a>chick &lt;-<span class="st"> </span><span class="kw">read_excel</span>(file_path, </span>
<span id="cb9-2"><a href="data-reading-wrangling-and-writing.html#cb9-2"></a>                    <span class="dt">sheet =</span> <span class="st">&quot;nestlingMass&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># import</span></span>
<span id="cb9-3"><a href="data-reading-wrangling-and-writing.html#cb9-3"></a><span class="st">  </span><span class="kw">clean_names</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># clean the column names</span></span>
<span id="cb9-4"><a href="data-reading-wrangling-and-writing.html#cb9-4"></a><span class="st">  </span><span class="kw">data.table</span>() <span class="co"># convert to data.table</span></span></code></pre></div>
<p>Very similar to the code above but without pipes. This requires complete assignment statements (<code>meh &lt;- blah</code>). This is easy to read but the pipes (above) use slightly less type and indent the post-import-processing steps and so the pipes make the script a wee bit more organized.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="data-reading-wrangling-and-writing.html#cb10-1"></a>chick &lt;-<span class="st"> </span><span class="kw">read_excel</span>(file_path, </span>
<span id="cb10-2"><a href="data-reading-wrangling-and-writing.html#cb10-2"></a>                    <span class="dt">sheet =</span> <span class="st">&quot;nestlingMass&quot;</span>)<span class="co"># import</span></span>
<span id="cb10-3"><a href="data-reading-wrangling-and-writing.html#cb10-3"></a>chick &lt;-<span class="st"> </span><span class="kw">clean_names</span>(chick) <span class="co"># clean the column names</span></span>
<span id="cb10-4"><a href="data-reading-wrangling-and-writing.html#cb10-4"></a>chick &lt;-<span class="st"> </span><span class="kw">data.table</span>(chick) <span class="co"># convert to data.table</span></span></code></pre></div>
<p>The script above that simply embeds each function. To read this, you have to start deep and then move out. This is easy enough for this statement if you are used to reading this kinda stuff. But nests of embedded functions can quickly become hard to read and the future you will be happy if you don’t do this. I sometimes will nest a single function in another but I’m trying to switch my default to pipes.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="data-reading-wrangling-and-writing.html#cb11-1"></a>chick &lt;-<span class="st"> </span><span class="kw">data.table</span>(<span class="kw">clean_names</span>(<span class="kw">read_excel</span>(file_path, </span>
<span id="cb11-2"><a href="data-reading-wrangling-and-writing.html#cb11-2"></a>                    <span class="dt">sheet =</span> <span class="st">&quot;nestlingMass&quot;</span>))) <span class="co"># convert to data.table</span></span></code></pre></div>
<div id="the-read_excel-function" class="section level5">
<h5><span class="header-section-number">2.2.1.1.1</span> The read_excel function</h5>
<p><code>read_excel</code> is a beautifully flexible function because Excel. Data can be in different sheets and there can be different datasets within a single sheet. And, researchers tend to use Excel like a blackboard in that an Excel sheet often contains calculations such as means, standard deviations and t-tests. When using <code>read_excel</code> it is important to send the function enough information to read the correct data. For the chick data, if we simply used</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="data-reading-wrangling-and-writing.html#cb12-1"></a>chick &lt;-<span class="st"> </span><span class="kw">read_excel</span>(file_path) <span class="op">%&gt;%</span></span>
<span id="cb12-2"><a href="data-reading-wrangling-and-writing.html#cb12-2"></a><span class="st">  </span><span class="kw">clean_names</span>() <span class="op">%&gt;%</span></span>
<span id="cb12-3"><a href="data-reading-wrangling-and-writing.html#cb12-3"></a><span class="st">  </span><span class="kw">data.table</span>()</span></code></pre></div>
<p>without specifying the sheet, <code>read_excel</code> defaults to reading the first sheet (“OccurrenceIncubationCall”), which is not what we wanted. We can specify the exact range to important using the <code>range =</code> argument</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="data-reading-wrangling-and-writing.html#cb13-1"></a>chick &lt;-<span class="st"> </span><span class="kw">read_excel</span>(file_path, </span>
<span id="cb13-2"><a href="data-reading-wrangling-and-writing.html#cb13-2"></a>                    <span class="dt">sheet =</span> <span class="st">&quot;nestlingMass&quot;</span>,</span>
<span id="cb13-3"><a href="data-reading-wrangling-and-writing.html#cb13-3"></a>                    <span class="dt">range =</span> <span class="st">&quot;A1:Q131&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># import</span></span>
<span id="cb13-4"><a href="data-reading-wrangling-and-writing.html#cb13-4"></a><span class="st">  </span><span class="kw">clean_names</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># clean the column names</span></span>
<span id="cb13-5"><a href="data-reading-wrangling-and-writing.html#cb13-5"></a><span class="st">  </span><span class="kw">data.table</span>() <span class="co"># convert to data.table</span></span></code></pre></div>
<p>This isn’t necessary for these data because the “nestlingMass” sheet contains only a matrix of data and not extraneous information and the <code>read_excel</code> function is smart enough to figure this out. For many of the data sets in wet bench experimental biology, the range argument will be crucial.</p>
</div>
<div id="view-the-imported-data.table-to-check-that-the-file-was-imported-correctly-and-to-learn-about-the-contents." class="section level5">
<h5><span class="header-section-number">2.2.1.1.2</span> View the imported data.table to check that the file was imported correctly and to learn about the contents.</h5>
<p>Insert the following after your import script and run:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="data-reading-wrangling-and-writing.html#cb14-1"></a><span class="kw">View</span>(chick) <span class="co"># check</span></span></code></pre></div>
<p>The line <code>View(chick)</code> script opens a new tab containing a spreadsheet-like display of the data.table <code>chick</code>.</p>
<p>Okay, let’s back up to understand why we post-process with <code>clean_names</code>. Re-import the data but without this function. I’ve done this by simply commenting out the line. The pipe above then skips over this and goes to <code>data.table()</code>.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="data-reading-wrangling-and-writing.html#cb15-1"></a>chick &lt;-<span class="st"> </span><span class="kw">read_excel</span>(file_path, </span>
<span id="cb15-2"><a href="data-reading-wrangling-and-writing.html#cb15-2"></a>                    <span class="dt">sheet=</span><span class="st">&quot;nestlingMass&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># import</span></span>
<span id="cb15-3"><a href="data-reading-wrangling-and-writing.html#cb15-3"></a><span class="co">#  clean_names() %&gt;% # clean the column names</span></span>
<span id="cb15-4"><a href="data-reading-wrangling-and-writing.html#cb15-4"></a><span class="st">  </span><span class="kw">data.table</span>() <span class="co"># convert to data.table</span></span></code></pre></div>
<p>You can see the column names of <code>chick</code> using View but I find it easier to look at these names using <code>names</code> or <code>colnames</code> (yes, there are elebenty million ways to do anything in R) (<code>names</code> is very general in that it can be used to return the names of the parts of any list, while <code>colnames</code> is specific to matrix-like objects)</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="data-reading-wrangling-and-writing.html#cb16-1"></a><span class="kw">names</span>(chick)</span></code></pre></div>
<pre><code>##  [1] &quot;chick ID&quot;                       &quot;brood ID&quot;                      
##  [3] &quot;brood composition&quot;              &quot;sex&quot;                           
##  [5] &quot;rank in nest&quot;                   &quot;playback treatment&quot;            
##  [7] &quot;nest temperature above ambient&quot; &quot;max daily temp hatch day&quot;      
##  [9] &quot;mean max temp hatch to day2&quot;    &quot;mean max temp hatch to day10&quot;  
## [11] &quot;mean max temp hatch to day13&quot;   &quot;hatching mass&quot;                 
## [13] &quot;day1 mass&quot;                      &quot;day2 mass&quot;                     
## [15] &quot;day10 mass&quot;                     &quot;day13 mass&quot;                    
## [17] &quot;day13 tarsus&quot;</code></pre>
<p>In general, it is bad practice to include spaces, parentheses, and special characters such as -, $ or ^, in the column names of a data frame because these increase handling costs later on. The best practice is to replace a blank with an underscore, for example <code>rank_in_nest</code>. Some coders separate words with a period (<code>rank.in.nest</code>). Others mash words together into a single word like this <code>rankinnest</code> but this should generally be avoided because the result can be hard to read. Finally, some coders use Caps to separate words like this <code>RankInNest</code>. This is easier to read than simple concatenation but the underscore is the easiest to read.</p>
<p>The <code>clean_names</code> from the janitor package is a beautiful function to clean the column names of a data frame including replacing spaces with an underscore and stripping parentheses. The default clean includes changing any uppercase letter to lower case. Many coders like to work with all lowercase variable names to avoid having to hit the shift key. I am one of these.</p>
<div style="background-color:#cccccc; text-align:left; vertical-align: middle; padding:20px 47px;">
<p><strong>Worst Practices</strong> – resist the temptation to change the column names in the data file, which reduces reproducibility. Leave original data files original. Always increase reproducibility!</p>
</div>
<div style="background-color:#cccccc; text-align:left; vertical-align: middle; padding:20px 47px;">
<p><strong>colleague blues</strong> – Most researchers live in an Excel world and save data in a way that is efficient for computing stuff in Excel but not efficient for statistical analysis using R or other statistical computing software packages (with the exception of Graphpad Prism). Analyzing data will be much less frustrating if the data are saved in a format that facilitates analysis. Best practices for creating data files</p>
<ol style="list-style-type: decimal">
<li><p><a href="https://www.youtube.com/watch?time_continue=309&amp;v=Ry2xjTBtNFE" class="uri">https://www.youtube.com/watch?time_continue=309&amp;v=Ry2xjTBtNFE</a> – An excellent video introduction to best practices for organizing data in a spreadsheet that will subsequently be analyzed by statistics software.</p></li>
<li><p>Broman, K. W., &amp; Woo, K. H. (2017). Data organization in spreadsheets (No. e3183v1). <a href="https://doi.org/10.7287/peerj.preprints.3183v1" class="uri">https://doi.org/10.7287/peerj.preprints.3183v1</a> – An excelllent review of best practices for organizing data in a spreadsheet.</p></li>
</ol>
</div>
<div style="background-color:#cccccc; text-align:left; vertical-align: middle; padding:20px 47px;">
<p><strong>beginner blues</strong> – after running the code with the clean_names commented out, type this into the console <code>chick &lt;- clean_names(chick)</code>. Now if you look at the column names with <code>names(chick)</code>, you see the names have been cleaned. But, if you quit R Studio, then re-open the notebook and run the chunks, your column names will not be clean because your command to clean the names was not in the saved script but simply entered into the console. The memory of this change was lost when you quit R Studio. This is a very common beginner mistake – make changes with scripts in the console that aren’t preserved in the saved chunks in the notbook. I’m not advising against changing the values of objects in the console – I do this frequently when debugging or to experiment – but to simply be aware that if you want specific operations to be reproducible, they need to be in the saved chunks in your notebook file.</p>
</div>
<p>Delete the comment and re-run the chunk so that <code>chick</code> has clean names. Save the file!</p>
</div>
<div id="explore-with-plots" class="section level5">
<h5><span class="header-section-number">2.2.1.1.3</span> Explore with plots</h5>
<p>Did I mention to delete the comment in front of <code>clean_names</code> and re-run the chunk so that <code>chick</code> has clean names?</p>
<p>Just for fun, let’s plot the data and reproduce something close to Fig. 2A and B. We are using the <code>qplot</code> function, which is from the ggplot2 package. qplots are quick plots – something you want to do to quickly look at data but don’t want to turn into a publication quality plot.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="data-reading-wrangling-and-writing.html#cb18-1"></a><span class="kw">qplot</span>(<span class="dt">x =</span> nest_temperature_above_ambient,</span>
<span id="cb18-2"><a href="data-reading-wrangling-and-writing.html#cb18-2"></a>      <span class="dt">y =</span> day13_mass,</span>
<span id="cb18-3"><a href="data-reading-wrangling-and-writing.html#cb18-3"></a>      <span class="dt">data =</span> chick[playback_treatment <span class="op">==</span><span class="st"> &quot;treat&quot;</span>]) <span class="op">+</span></span>
<span id="cb18-4"><a href="data-reading-wrangling-and-writing.html#cb18-4"></a><span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">method =</span> <span class="st">&quot;lm&quot;</span>)</span></code></pre></div>
<pre><code>## `geom_smooth()` using formula &#39;y ~ x&#39;</code></pre>
<p><img src="Walker-elementary-statistical-modeling-draft_files/figure-html/data-plotchickdata-1.png" width="576" /></p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="data-reading-wrangling-and-writing.html#cb20-1"></a><span class="kw">qplot</span>(<span class="dt">x =</span> nest_temperature_above_ambient,</span>
<span id="cb20-2"><a href="data-reading-wrangling-and-writing.html#cb20-2"></a>      <span class="dt">y =</span> day13_mass,</span>
<span id="cb20-3"><a href="data-reading-wrangling-and-writing.html#cb20-3"></a>      <span class="dt">data =</span> chick[playback_treatment <span class="op">==</span><span class="st"> &quot;cont&quot;</span>]) <span class="op">+</span></span>
<span id="cb20-4"><a href="data-reading-wrangling-and-writing.html#cb20-4"></a><span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">method =</span> <span class="st">&quot;lm&quot;</span>)</span></code></pre></div>
<pre><code>## `geom_smooth()` using formula &#39;y ~ x&#39;</code></pre>
<p><img src="Walker-elementary-statistical-modeling-draft_files/figure-html/data-plotchickdata-2.png" width="576" /></p>
<p>Notes on the code to make these plots</p>
<ol style="list-style-type: decimal">
<li>the names of the columns to use as the x and y axes were not embedded into quotes (e.g. “nest_temperature_above_ambient”). Sometimes a column name has to be in quotes and sometimes not. In general, if the column name is sent to the function as a list (even if its a list with a single item), the names need to be in quotes. Regardless, remember this when you are debugging.</li>
<li>The first plot includes only the subset of data in which the value of <code>playback_treatment</code> is “treat”. Similarly, the second plot includes only the subset of data in which the value of <code>playback_treatment</code> is “cont”. I have sent a subset of the data to the plot function. There are elebenty million ways to subset data in R, I have done it the “data.table way”.</li>
<li>each argument in the qplot function is on a separate line (created by adding a return after the comma) and the <code>geom_smooth</code> function is on a new line. This just makes the function more readable then not doing this. What do you think?</li>
</ol>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="data-reading-wrangling-and-writing.html#cb22-1"></a><span class="kw">qplot</span>(<span class="dt">x =</span> nest_temperature_above_ambient, <span class="dt">y =</span> day13_mass, <span class="dt">data =</span> chick[playback_treatment <span class="op">==</span><span class="st"> &quot;treat&quot;</span>]) <span class="op">+</span><span class="st"> </span><span class="kw">geom_smooth</span>(<span class="dt">method =</span> <span class="st">&quot;lm&quot;</span>)</span></code></pre></div>
<ol start="4" style="list-style-type: decimal">
<li>I have included the name of each argument. This isn’t necessary but it makes the function more readable <em>and</em> avoids potential bugs. The arguments without the argument names looks like this</li>
</ol>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="data-reading-wrangling-and-writing.html#cb23-1"></a><span class="kw">qplot</span>(nest_temperature_above_ambient, day13_mass, <span class="dt">data =</span> chick[playback_treatment <span class="op">==</span><span class="st"> &quot;treat&quot;</span>]) <span class="op">+</span><span class="st"> </span><span class="kw">geom_smooth</span>(<span class="dt">method =</span> <span class="st">&quot;lm&quot;</span>)</span></code></pre></div>
</div>
</div>
<div id="text-file" class="section level4">
<h4><span class="header-section-number">2.2.1.2</span> Text file</h4>
<p>The example dataset comes from an experiment on the effect of <a href="http://science.sciencemag.org/content/early/2012/03/28/science.1215025" target="_blank">neonicotinoid pesticides on bumble bee colony growth</a>.</p>
<p><strong>file name</strong>: “Whitehorn, O’Connor, Wackers, Goulson (2012) Data from ‘Neonicotinoid pesticide reduces bumblebee colony growth and queen production’.csv.csv”</p>
<p><strong>source</strong>: <a href="https://datadryad.org//resource/doi:10.5061/dryad.1805c973" class="uri">https://datadryad.org//resource/doi:10.5061/dryad.1805c973</a></p>
<p>Steps</p>
<ol style="list-style-type: decimal">
<li>Copy the title of the paper title, which is “Neonicotinoid pesticide reduces bumblebee colony growth and queen production”</li>
<li>Create a new folder within “data”. Name the folder the title of the paper by pasting from the clipboard. This is the “data from” folder, since it contains the data from the publication with the title of the folder.</li>
<li>Download the .csv file into this folder</li>
</ol>
<p>A .csv file is a text file that is comma-delimted, which means that the entries of a row are separated by commas. A text file is readable by any text editor software and most other kinds of software. Datasets that are stored as text files are typically saved as either .csv (where the entries of a row are separated by commas) or .txt (where the entries are separated by tabs). The base R way to read a .csv file is using <code>read.csv</code>. The <code>read.table</code> function is more versatile, as the delimiter can be specified. The function <code>fread()</code> from the data.table package is fast, smart, and flexible. It is smart in the sense that it guesses what the delimter is. Unfortunately, because of spaces in the column labels for this file, fread guesses incorrectly (another reason why spaces in column labels should be avoided). To overcome this, the statement below specifies that the file contains a “header” (a line containing column labels)</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="data-reading-wrangling-and-writing.html#cb24-1"></a>folder &lt;-<span class="st"> &quot;Neonicotinoid pesticide reduces bumblebee colony growth and queen production&quot;</span></span>
<span id="cb24-2"><a href="data-reading-wrangling-and-writing.html#cb24-2"></a>filename &lt;-<span class="st"> &quot;Whitehorn, O&#39;Connor, Wackers, Goulson (2012) Data from &#39;Neonicotinoid pesticide reduces bumblebee colony growth and queen production&#39;.csv.csv&quot;</span></span>
<span id="cb24-3"><a href="data-reading-wrangling-and-writing.html#cb24-3"></a>file_path &lt;-<span class="st"> </span><span class="kw">here</span>(data_folder, folder, filename)</span>
<span id="cb24-4"><a href="data-reading-wrangling-and-writing.html#cb24-4"></a>bee &lt;-<span class="st"> </span><span class="kw">fread</span>(file_path, <span class="dt">header=</span><span class="ot">TRUE</span>) <span class="op">%&gt;%</span></span>
<span id="cb24-5"><a href="data-reading-wrangling-and-writing.html#cb24-5"></a><span class="st">  </span><span class="kw">clean_names</span>()</span></code></pre></div>
<p>Here, as with the import of the Excel file, the first three lines create the directory path to the file. There is no need to pipe <code>bee</code> to <code>data.table()</code> because <code>fread</code> automatically importants the data as a data.table. It does not need to be converted.</p>
<p>Here is a reproduction of Fig 2 from the journal article.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="data-reading-wrangling-and-writing.html#cb25-1"></a>bee[, treatment<span class="op">:</span><span class="er">=</span><span class="kw">factor</span>(treatment, <span class="kw">c</span>(<span class="st">&quot;Control&quot;</span>, <span class="st">&quot;Low&quot;</span>, <span class="st">&quot;High&quot;</span>))] <span class="co"># reorder factor levels</span></span>
<span id="cb25-2"><a href="data-reading-wrangling-and-writing.html#cb25-2"></a><span class="kw">ggbarplot</span>(<span class="dt">data=</span>bee, <span class="dt">x=</span><span class="st">&quot;treatment&quot;</span>, <span class="dt">y=</span><span class="st">&quot;new_queens&quot;</span>, <span class="dt">add =</span> <span class="st">&quot;mean_se&quot;</span>)</span></code></pre></div>
<p><img src="Walker-elementary-statistical-modeling-draft_files/figure-html/data-plot-bee-fig-2-1.png" width="576" /></p>
</div>
<div id="troubleshooting-file-import" class="section level4">
<h4><span class="header-section-number">2.2.1.3</span> Troubleshooting file import</h4>
<p>If you get an error that starts with “Error: <code>path</code> does not exist:” then R is not “seeing” your specified file given the path you’ve given it.</p>
<ol style="list-style-type: decimal">
<li>Make sure you loaded the package <code>here</code> in a “setup” chunk and that you have run the chunk</li>
<li>Make sure you have assigned <code>data_folder &lt;- "data"</code> in the setup chunk and have run the chunk.</li>
<li>Make sure your “data” folder is <em>one level</em> inside your project folder. “one level” means it is not buried deeper inside other folders within the project folder.</li>
<li>Make sure your “data from” folder (the folder with the title of the publication) is one level inside your “data” folder</li>
<li>Make sure your data file is one level inside the correct “data from” folder.</li>
<li><strong>Bug alert</strong> Make sure you have the name of the “data from …” folder correct in your script. Do not type the name of the folder. Instead, go to the finder and highlight the folder containing the data file, copy the name, return to the R markdown script, type <code>folder &lt;- ""</code> and then paste the clipboard (the name of the folder) in between the quote marks.</li>
<li><strong>Bug alert</strong> Make sure the file name is correct in the script. As with the folder name, I go to the finder and copy the file name and paste it in place. In Windows use ctrl-a instead of ctrl-c to copy the full filename including the extension.</li>
</ol>
<p>More generally, Humans are very good at understanding misspelled and OdDLy capitalized words but the R language (or any computer language) is very literal. R is <strong>case sensitive</strong> (some programming languages are not). “Prenatal acoustic communication”, “Prenatal Acoustic Communication”, and “prenatal acoustic communication” are all different values. Spelling AND capitalization have to be perfect, not simply close. Spelling includes <em>spaces</em>. A frequent bug is a file name typed as “Prenatal acoustic communication” when the actual name is “Prenatal acoustic communication”. Can you spot the bug? The original (what we need to copy) has two spaces between “acoustic” and “communication” while the incorrect copy has only one.</p>
<p>Spelling bugs are avoided by simply copying and pasting names of folders, names of files, column names of data frames, and level names of factors, which leads to a general rule of R scripting…</p>
</div>
<div id="rule-number-one-in-r-scripting-rule1" class="section level4">
<h4><span class="header-section-number">2.2.1.4</span> Rule number one in R scripting {# rule1}</h4>
<p><strong>Always copy and paste any text that will be inserted into quotes</strong></p>
<p>Do not try to type it out. You have been warned.</p>
</div>
</div>
</div>
<div id="data-wrangling" class="section level2">
<h2><span class="header-section-number">2.3</span> Data wrangling</h2>
<p>Data archived in Excel spreadsheets, at least in wet-bench experimental biology projects, are generally not in a format this is readily analyzed in R, or any statistical software other than perhaps Graphpad Prism. Use these examples as templates for how to import and wrangle Excel-archived data in your project.</p>
<div id="reshaping-data-wide-to-long" class="section level3">
<h3><span class="header-section-number">2.3.1</span> Reshaping data – Wide to long</h3>
<div id="wide-to-long-adipsin-data" class="section level4">
<h4><span class="header-section-number">2.3.1.1</span> Wide to long – Adipsin data</h4>
<p>Source: <a href="https://www.nature.com/articles/s41591-019-0610-4">Adipsin preserves beta cells in diabetic mice and associates with protection from type 2 diabetes in humans</a></p>
<p><img src="images/adipsin_fig1h_data.png" width="60%" /></p>
<p>Fig. 1h of the Adipsin paper presents three bar plots, each comparing a response variable between the control (GFP) and treated (Adipsin) groups. A screenshot of the Excel-archived data is shown above. The data are in <strong>wide format</strong>. In wide-format, the values of a variable are in separate columns for each treatment level (group). This is seen in the screenshot of the data. In the data for the first panel of Fig. 1h (Total C3), the values for the GFP group are in Column A and the values for the Adipsin group are in Column B. Wide format is efficient for computations in a spreadsheet, such as computing means and standard deviations of columns of data, and for plotting.</p>
<p>For most statistical analyses of experimental data in R (and most statistics software), all values of a single variable should be in a single column. This is called <strong>long format</strong>. I’ve rearranged the data from the archived spread sheet into long format by stacking each group’s values into a single column, shown in the screen capture below. All values of total C3 are in a single column, as are the values for the other variables. In long format, there needs to be a way to identify which values belong to which group and this is achieved with column “treatment”. In adition to the treatment column, I created a column containing the mouse identification number (I made these up as they were not given in the Excel-archived data).</p>
<p><img src="images/adipsin_fig1h_long.png" width="60%" /></p>
<p>The difference between wide and long also reflects how we think about statistical analysis. When we do a <em>t</em>-test to compare the means of total C3 between GFP and Adipsin groups, we might think we have two things: the set of C3 values for the GFP group and the set of C3 values for the Adipsin group. When we fit a linear model, we also have two things, the variable <em>treatment</em> containing treatment level assignment and the variable <em>c3</em> containing the C3 values. In wide format, there is nothing to suggest that <em>treatment</em> is a variable.</p>
<p>There are many functions to tidy data from wide to long. <code>melt</code> from the data.table package is especially useful. It is data.table’s version of melt from the reshape2 package.</p>
<p>The major arguments of <code>data.table::melt</code> are</p>
<p><code>melt(data, id.vars, measure.vars, variable.name, value.name)</code></p>
<p><code>melt</code> takes the data in the columns listed in <code>measure.vars</code> and stacks these into a single column named <code>value.name</code>. The names of the columns in <code>measure.vars</code> are the values of the elements in a new column named <code>variable.name</code>. The elements of any column in <code>id.vars</code> are repeated <em>p</em> times, where <em>p</em> is the number of columns that were stacked.</p>
<p>Let’s melt the three different response variables of the adipsin data and <code>merge</code> them into a single data.table. There are several ways to combine data sets including <code>merge</code> and <code>cbind</code>. We’ll compare these later.</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="data-reading-wrangling-and-writing.html#cb26-1"></a>file_folder &lt;-<span class="st"> &quot;Adipsin preserves beta cells in diabetic mice and associates with protection from type 2 diabetes in humans&quot;</span></span>
<span id="cb26-2"><a href="data-reading-wrangling-and-writing.html#cb26-2"></a>fn &lt;-<span class="st"> &quot;41591_2019_610_MOESM3_ESM.xlsx&quot;</span></span>
<span id="cb26-3"><a href="data-reading-wrangling-and-writing.html#cb26-3"></a>file_path &lt;-<span class="st"> </span><span class="kw">here</span>(data_folder, file_folder, fn)</span>
<span id="cb26-4"><a href="data-reading-wrangling-and-writing.html#cb26-4"></a></span>
<span id="cb26-5"><a href="data-reading-wrangling-and-writing.html#cb26-5"></a>treatment_levels &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;GFP&quot;</span>,    <span class="st">&quot;Adipsin&quot;</span>)</span>
<span id="cb26-6"><a href="data-reading-wrangling-and-writing.html#cb26-6"></a></span>
<span id="cb26-7"><a href="data-reading-wrangling-and-writing.html#cb26-7"></a><span class="co"># separately read each treatment</span></span>
<span id="cb26-8"><a href="data-reading-wrangling-and-writing.html#cb26-8"></a>fig1h_total &lt;-<span class="st"> </span><span class="kw">read_excel</span>(file_path,</span>
<span id="cb26-9"><a href="data-reading-wrangling-and-writing.html#cb26-9"></a>                    <span class="dt">sheet =</span> <span class="st">&quot;Figure 1h&quot;</span>,</span>
<span id="cb26-10"><a href="data-reading-wrangling-and-writing.html#cb26-10"></a>                    <span class="dt">range =</span> <span class="st">&quot;A3:B7&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb26-11"><a href="data-reading-wrangling-and-writing.html#cb26-11"></a><span class="st">  </span><span class="kw">data.table</span>() <span class="op">%&gt;%</span></span>
<span id="cb26-12"><a href="data-reading-wrangling-and-writing.html#cb26-12"></a><span class="st">  </span><span class="kw">melt</span>(<span class="dt">measure.vars =</span> treatment_levels,</span>
<span id="cb26-13"><a href="data-reading-wrangling-and-writing.html#cb26-13"></a>       <span class="dt">variable.name =</span> <span class="st">&quot;treatment&quot;</span>,</span>
<span id="cb26-14"><a href="data-reading-wrangling-and-writing.html#cb26-14"></a>       <span class="dt">value.name =</span> <span class="st">&quot;total_c3&quot;</span>)</span>
<span id="cb26-15"><a href="data-reading-wrangling-and-writing.html#cb26-15"></a><span class="co"># give each mouse a unique ID</span></span>
<span id="cb26-16"><a href="data-reading-wrangling-and-writing.html#cb26-16"></a>fig1h_total[, mouse_id <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="dv">1</span><span class="op">:</span>.N]  </span>
<span id="cb26-17"><a href="data-reading-wrangling-and-writing.html#cb26-17"></a>  </span>
<span id="cb26-18"><a href="data-reading-wrangling-and-writing.html#cb26-18"></a>fig1h_ratio &lt;-<span class="st"> </span><span class="kw">read_excel</span>(file_path,</span>
<span id="cb26-19"><a href="data-reading-wrangling-and-writing.html#cb26-19"></a>                    <span class="dt">sheet =</span> <span class="st">&quot;Figure 1h&quot;</span>,</span>
<span id="cb26-20"><a href="data-reading-wrangling-and-writing.html#cb26-20"></a>                    <span class="dt">range =</span> <span class="st">&quot;A11:B15&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb26-21"><a href="data-reading-wrangling-and-writing.html#cb26-21"></a><span class="st">  </span><span class="kw">data.table</span>() <span class="op">%&gt;%</span></span>
<span id="cb26-22"><a href="data-reading-wrangling-and-writing.html#cb26-22"></a><span class="st">  </span><span class="kw">melt</span>(<span class="dt">measure.vars =</span> treatment_levels,</span>
<span id="cb26-23"><a href="data-reading-wrangling-and-writing.html#cb26-23"></a>       <span class="dt">variable.name =</span> <span class="st">&quot;treatment&quot;</span>,</span>
<span id="cb26-24"><a href="data-reading-wrangling-and-writing.html#cb26-24"></a>       <span class="dt">value.name =</span> <span class="st">&quot;ratio&quot;</span>)</span>
<span id="cb26-25"><a href="data-reading-wrangling-and-writing.html#cb26-25"></a><span class="co"># give each mouse a unique ID</span></span>
<span id="cb26-26"><a href="data-reading-wrangling-and-writing.html#cb26-26"></a>fig1h_ratio[, mouse_id <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="dv">1</span><span class="op">:</span>.N]  </span>
<span id="cb26-27"><a href="data-reading-wrangling-and-writing.html#cb26-27"></a></span>
<span id="cb26-28"><a href="data-reading-wrangling-and-writing.html#cb26-28"></a>fig1h_c3a &lt;-<span class="st"> </span><span class="kw">read_excel</span>(file_path,</span>
<span id="cb26-29"><a href="data-reading-wrangling-and-writing.html#cb26-29"></a>                    <span class="dt">sheet =</span> <span class="st">&quot;Figure 1h&quot;</span>,</span>
<span id="cb26-30"><a href="data-reading-wrangling-and-writing.html#cb26-30"></a>                    <span class="dt">range =</span> <span class="st">&quot;A18:B22&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb26-31"><a href="data-reading-wrangling-and-writing.html#cb26-31"></a><span class="st">  </span><span class="kw">data.table</span>() <span class="op">%&gt;%</span></span>
<span id="cb26-32"><a href="data-reading-wrangling-and-writing.html#cb26-32"></a><span class="st">  </span><span class="kw">melt</span>(<span class="dt">measure.vars =</span> treatment_levels,</span>
<span id="cb26-33"><a href="data-reading-wrangling-and-writing.html#cb26-33"></a>       <span class="dt">variable.name =</span> <span class="st">&quot;treatment&quot;</span>,</span>
<span id="cb26-34"><a href="data-reading-wrangling-and-writing.html#cb26-34"></a>       <span class="dt">value.name =</span> <span class="st">&quot;c3a&quot;</span>)</span>
<span id="cb26-35"><a href="data-reading-wrangling-and-writing.html#cb26-35"></a><span class="co"># give each mouse a unique ID</span></span>
<span id="cb26-36"><a href="data-reading-wrangling-and-writing.html#cb26-36"></a>fig1h_c3a[, mouse_id <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="dv">1</span><span class="op">:</span>.N] </span>
<span id="cb26-37"><a href="data-reading-wrangling-and-writing.html#cb26-37"></a></span>
<span id="cb26-38"><a href="data-reading-wrangling-and-writing.html#cb26-38"></a>fig1h &lt;-<span class="st"> </span><span class="kw">merge</span>(fig1h_total, fig1h_c3a,</span>
<span id="cb26-39"><a href="data-reading-wrangling-and-writing.html#cb26-39"></a>               <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;treatment&quot;</span>, <span class="st">&quot;mouse_id&quot;</span>))</span>
<span id="cb26-40"><a href="data-reading-wrangling-and-writing.html#cb26-40"></a>fig1h &lt;-<span class="st"> </span><span class="kw">merge</span>(fig1h, fig1h_ratio,</span>
<span id="cb26-41"><a href="data-reading-wrangling-and-writing.html#cb26-41"></a>               <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;treatment&quot;</span>, <span class="st">&quot;mouse_id&quot;</span>))</span>
<span id="cb26-42"><a href="data-reading-wrangling-and-writing.html#cb26-42"></a>fig1h[, check_ratio <span class="op">:</span><span class="er">=</span><span class="st"> </span>c3a<span class="op">/</span>total_c3]</span>
<span id="cb26-43"><a href="data-reading-wrangling-and-writing.html#cb26-43"></a></span>
<span id="cb26-44"><a href="data-reading-wrangling-and-writing.html#cb26-44"></a><span class="co"># View(fig1h) # uncomment to view</span></span></code></pre></div>
</div>
<div id="wide-to-long-enteric-nervous-system-data" class="section level4">
<h4><span class="header-section-number">2.3.1.2</span> Wide to long – Enteric nervous system data</h4>
<p>Article: Rolig, A. S., Mittge, E. K., Ganz, J., Troll, J. V., Melancon, E., Wiles, T. J., … Guillemin, K. (2017). The enteric nervous system promotes intestinal health by constraining microbiota composition. PLOS Biology, 15(2), e2000689. <a href="https://doi.org/10.1371/journal.pbio.2000689" class="uri">https://doi.org/10.1371/journal.pbio.2000689</a></p>
<p><strong>Data source</strong> <a href="https://doi.org/10.1371/journal.pbio.2000689.s008" class="uri">https://doi.org/10.1371/journal.pbio.2000689.s008</a></p>
<p><strong>file name</strong>: “journal.pbio.2000689.s008.xlsx”</p>
<p>Let’s import and reshape the data for figure 2d. Look at the excel file and the data in Fig. 2d. There is a single treament with four levels, but the authors have organized the data in each level in separate columns and used the column header as the level name.</p>
<p><img src="images/enteric_fig2d_wide.png" width="60%" /></p>
<p>Let’s melt the data from wide to long by stacking the four columns into a single column “neutrophil_count” and adding a treatment column identifying the group.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="data-reading-wrangling-and-writing.html#cb27-1"></a>folder &lt;-<span class="st"> &quot;The enteric nervous system promotes intestinal health by constraining microbiota composition&quot;</span></span>
<span id="cb27-2"><a href="data-reading-wrangling-and-writing.html#cb27-2"></a>filename &lt;-<span class="st"> &quot;journal.pbio.2000689.s008.xlsx&quot;</span></span>
<span id="cb27-3"><a href="data-reading-wrangling-and-writing.html#cb27-3"></a>file_path &lt;-<span class="st"> </span><span class="kw">here</span>(data_folder, folder, filename)</span>
<span id="cb27-4"><a href="data-reading-wrangling-and-writing.html#cb27-4"></a></span>
<span id="cb27-5"><a href="data-reading-wrangling-and-writing.html#cb27-5"></a><span class="co"># figure 2D data</span></span>
<span id="cb27-6"><a href="data-reading-wrangling-and-writing.html#cb27-6"></a>sheet_i &lt;-<span class="st"> &quot;Figure 2&quot;</span></span>
<span id="cb27-7"><a href="data-reading-wrangling-and-writing.html#cb27-7"></a>range_i &lt;-<span class="st"> &quot;F2:I24&quot;</span></span>
<span id="cb27-8"><a href="data-reading-wrangling-and-writing.html#cb27-8"></a>fig_2d_wide &lt;-<span class="st"> </span><span class="kw">read_excel</span>(file_path, <span class="dt">sheet=</span>sheet_i, <span class="dt">range=</span>range_i) <span class="op">%&gt;%</span></span>
<span id="cb27-9"><a href="data-reading-wrangling-and-writing.html#cb27-9"></a><span class="st">  </span><span class="kw">clean_names</span>() <span class="op">%&gt;%</span></span>
<span id="cb27-10"><a href="data-reading-wrangling-and-writing.html#cb27-10"></a><span class="st">  </span><span class="kw">data.table</span>()</span>
<span id="cb27-11"><a href="data-reading-wrangling-and-writing.html#cb27-11"></a></span>
<span id="cb27-12"><a href="data-reading-wrangling-and-writing.html#cb27-12"></a><span class="co"># change column names by replacing without &quot;_donor&quot; in each name</span></span>
<span id="cb27-13"><a href="data-reading-wrangling-and-writing.html#cb27-13"></a><span class="co"># these new column names will become the levels of the treatment factor</span></span>
<span id="cb27-14"><a href="data-reading-wrangling-and-writing.html#cb27-14"></a>new_colnames &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;gf&quot;</span>, <span class="st">&quot;wt&quot;</span>, <span class="st">&quot;sox10&quot;</span>, <span class="st">&quot;iap_mo&quot;</span>)</span>
<span id="cb27-15"><a href="data-reading-wrangling-and-writing.html#cb27-15"></a><span class="kw">setnames</span>(fig_2d_wide, <span class="dt">old=</span><span class="kw">colnames</span>(fig_2d_wide), <span class="dt">new=</span>new_colnames)</span>
<span id="cb27-16"><a href="data-reading-wrangling-and-writing.html#cb27-16"></a></span>
<span id="cb27-17"><a href="data-reading-wrangling-and-writing.html#cb27-17"></a><span class="co"># wide to long</span></span>
<span id="cb27-18"><a href="data-reading-wrangling-and-writing.html#cb27-18"></a>fig_2d &lt;-<span class="st"> </span><span class="kw">melt</span>(fig_2d_wide, </span>
<span id="cb27-19"><a href="data-reading-wrangling-and-writing.html#cb27-19"></a>              <span class="dt">measure.vars=</span><span class="kw">colnames</span>(fig_2d_wide), </span>
<span id="cb27-20"><a href="data-reading-wrangling-and-writing.html#cb27-20"></a>              <span class="dt">variable.name=</span><span class="st">&quot;treatment&quot;</span>, </span>
<span id="cb27-21"><a href="data-reading-wrangling-and-writing.html#cb27-21"></a>              <span class="dt">value.name=</span><span class="st">&quot;neutrophil_count&quot;</span>)</span>
<span id="cb27-22"><a href="data-reading-wrangling-and-writing.html#cb27-22"></a></span>
<span id="cb27-23"><a href="data-reading-wrangling-and-writing.html#cb27-23"></a><span class="co"># omit empty rows</span></span>
<span id="cb27-24"><a href="data-reading-wrangling-and-writing.html#cb27-24"></a>fig_2d &lt;-<span class="st"> </span><span class="kw">na.omit</span>(fig_2d)</span>
<span id="cb27-25"><a href="data-reading-wrangling-and-writing.html#cb27-25"></a></span>
<span id="cb27-26"><a href="data-reading-wrangling-and-writing.html#cb27-26"></a><span class="co"># re-order factors</span></span>
<span id="cb27-27"><a href="data-reading-wrangling-and-writing.html#cb27-27"></a>fig_2d[, treatment <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">factor</span>(treatment,</span>
<span id="cb27-28"><a href="data-reading-wrangling-and-writing.html#cb27-28"></a>                         <span class="dt">levels =</span> <span class="kw">c</span>(<span class="st">&quot;wt&quot;</span>, <span class="st">&quot;gf&quot;</span>, <span class="st">&quot;sox10&quot;</span>, <span class="st">&quot;iap_mo&quot;</span>))]</span>
<span id="cb27-29"><a href="data-reading-wrangling-and-writing.html#cb27-29"></a></span>
<span id="cb27-30"><a href="data-reading-wrangling-and-writing.html#cb27-30"></a><span class="co"># View(fig_2d)</span></span></code></pre></div>
<p>To learn (instead of just copy and modify), it’s best to do this in steps and not run the whole chunk. At each step, look at the result using View. The script above includes three extra wrangling steps.</p>
<ol style="list-style-type: decimal">
<li><p>Changing column names in fig_2d_wide. The column names in wide format will become the treatment level names of the <em>treatment</em> factor after reshaping. It will be easier down the road if these names are shorter and the "_donor" in each name is redundant. The <code>setnames</code> function renames the column names.</p></li>
<li><p>For these data, the number of measures within the different treatments differs and, as a consequence, there are multiple cells with <code>NA</code> which indicates a missing value. <code>View(fig_2d_wide)</code> (this can be typed in the console) to see this. After reshaping to long format (fig_2d), the rows with missing values become empty rows – there is no useful information in them (View this). To see this, re-run the lines of the chunk up to the line “# omit empty rows”. The <code>na.omit</code> function deletes any row with missing values. Here, this deletes these information-less rows. Be very careful with <code>na.omit</code>. You do not want to delete rows of data that contain information you want.</p></li>
<li><p>For both analysis and plots, we want to compare values to the control level, which is named “wt” for the fig_2d data. That is, we want “wt” to be the <em>reference</em> level. To achieve this, the levels of the factor <em>treatment</em> need to be re-ordered using the <code>levels</code> argument. (note, I typically do not add “levels =”, but simply pass the list of levels)</p></li>
</ol>
</div>
<div id="wide-to-long-bee-data" class="section level4">
<h4><span class="header-section-number">2.3.1.3</span> Wide to long – bee data</h4>
<p>The example above is pretty easy, because the all columns in the original data frame are melted (stacked). Here is an example in which only a subset of columns are stacked. In addition, only a subset of the remaining columns are retained in the long format data frame. The data are from Panel A of supplement Fig. 8 (<a href="https://journals.plos.org/plosbiology/article/file?type=supplementary&amp;id=info:doi/10.1371/journal.pbio.2003467.s019" class="uri">https://journals.plos.org/plosbiology/article/file?type=supplementary&amp;id=info:doi/10.1371/journal.pbio.2003467.s019</a>) from</p>
<p>Kešnerová, L., Mars, R.A., Ellegaard, K.M., Troilo, M., Sauer, U. and Engel, P., 2017. Disentangling metabolic functions of bacteria in the honey bee gut. PLoS biology, 15(12), p.e2003467.</p>
<p>**data source*:** <a href="https://doi.org/10.1371/journal.pbio.2003467.s001" class="uri">https://doi.org/10.1371/journal.pbio.2003467.s001</a></p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="data-reading-wrangling-and-writing.html#cb28-1"></a>folder &lt;-<span class="st"> &quot;Data from Disentangling metabolic functions of bacteria in the honey bee gut&quot;</span></span>
<span id="cb28-2"><a href="data-reading-wrangling-and-writing.html#cb28-2"></a>filename &lt;-<span class="st"> &quot;journal.pbio.2003467.s001.xlsx&quot;</span></span>
<span id="cb28-3"><a href="data-reading-wrangling-and-writing.html#cb28-3"></a></span>
<span id="cb28-4"><a href="data-reading-wrangling-and-writing.html#cb28-4"></a><span class="co"># figure 2D data</span></span>
<span id="cb28-5"><a href="data-reading-wrangling-and-writing.html#cb28-5"></a>sheet_i &lt;-<span class="st"> &quot;S8 Fig&quot;</span></span>
<span id="cb28-6"><a href="data-reading-wrangling-and-writing.html#cb28-6"></a>range_i &lt;-<span class="st"> &quot;A2:H12&quot;</span></span>
<span id="cb28-7"><a href="data-reading-wrangling-and-writing.html#cb28-7"></a>file_path &lt;-<span class="st"> </span><span class="kw">here</span>(data_folder, folder, filename)</span>
<span id="cb28-8"><a href="data-reading-wrangling-and-writing.html#cb28-8"></a>fig_s8a_wide &lt;-<span class="st"> </span><span class="kw">read_excel</span>(file_path,</span>
<span id="cb28-9"><a href="data-reading-wrangling-and-writing.html#cb28-9"></a>                      <span class="dt">sheet=</span>sheet_i,</span>
<span id="cb28-10"><a href="data-reading-wrangling-and-writing.html#cb28-10"></a>                      <span class="dt">range=</span>range_i) <span class="op">%&gt;%</span></span>
<span id="cb28-11"><a href="data-reading-wrangling-and-writing.html#cb28-11"></a><span class="st">  </span><span class="kw">clean_names</span>() <span class="op">%&gt;%</span></span>
<span id="cb28-12"><a href="data-reading-wrangling-and-writing.html#cb28-12"></a><span class="st">  </span><span class="kw">data.table</span>()</span>
<span id="cb28-13"><a href="data-reading-wrangling-and-writing.html#cb28-13"></a></span>
<span id="cb28-14"><a href="data-reading-wrangling-and-writing.html#cb28-14"></a><span class="co"># wide to long</span></span>
<span id="cb28-15"><a href="data-reading-wrangling-and-writing.html#cb28-15"></a>stack_cols &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;replicate&quot;</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">5</span>)</span>
<span id="cb28-16"><a href="data-reading-wrangling-and-writing.html#cb28-16"></a>fig_s8a &lt;-<span class="st"> </span><span class="kw">melt</span>(fig_s8a_wide,</span>
<span id="cb28-17"><a href="data-reading-wrangling-and-writing.html#cb28-17"></a>              <span class="dt">id.vars =</span> <span class="kw">c</span>(<span class="st">&quot;media&quot;</span>, <span class="st">&quot;time_h&quot;</span>),</span>
<span id="cb28-18"><a href="data-reading-wrangling-and-writing.html#cb28-18"></a>              <span class="dt">measure.vars =</span> stack_cols, </span>
<span id="cb28-19"><a href="data-reading-wrangling-and-writing.html#cb28-19"></a>              <span class="dt">variable.name =</span> <span class="st">&quot;Replicate&quot;</span>, </span>
<span id="cb28-20"><a href="data-reading-wrangling-and-writing.html#cb28-20"></a>              <span class="dt">value.name =</span> <span class="st">&quot;OD600&quot;</span>) <span class="co"># measure of absorbance at 600nm</span></span></code></pre></div>
</div>
<div id="wide-to-long-stacking-multiple-sets-of-columns" class="section level4">
<h4><span class="header-section-number">2.3.1.4</span> Wide to long – stacking multiple sets of columns</h4>
<p>This example comes from my lab, where a student measured sprint speed in each fish three times prior to treatment and three times following treatment. The wide format data looked something like this</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="data-reading-wrangling-and-writing.html#cb29-1"></a><span class="kw">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb29-2"><a href="data-reading-wrangling-and-writing.html#cb29-2"></a>fd_wide &lt;-<span class="st"> </span><span class="kw">data.table</span>(<span class="dt">fish_ID=</span><span class="kw">paste0</span>(<span class="st">&quot;fish&quot;</span>,<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>),</span>
<span id="cb29-3"><a href="data-reading-wrangling-and-writing.html#cb29-3"></a>                      <span class="dt">treatment=</span><span class="kw">rep</span>(<span class="kw">c</span>(<span class="st">&quot;cn&quot;</span>, <span class="st">&quot;tr&quot;</span>), <span class="dt">each=</span><span class="dv">2</span>),</span>
<span id="cb29-4"><a href="data-reading-wrangling-and-writing.html#cb29-4"></a>                      <span class="dt">length=</span><span class="kw">rnorm</span>(<span class="dv">4</span>, <span class="dv">12</span>, <span class="dv">2</span>),</span>
<span id="cb29-5"><a href="data-reading-wrangling-and-writing.html#cb29-5"></a>                      <span class="dt">pre_1=</span><span class="kw">rnorm</span>(<span class="dv">4</span>, <span class="dv">50</span>, <span class="dv">5</span>),</span>
<span id="cb29-6"><a href="data-reading-wrangling-and-writing.html#cb29-6"></a>                      <span class="dt">pre_2=</span><span class="kw">rnorm</span>(<span class="dv">4</span>, <span class="dv">50</span>, <span class="dv">5</span>),</span>
<span id="cb29-7"><a href="data-reading-wrangling-and-writing.html#cb29-7"></a>                      <span class="dt">pre_3=</span><span class="kw">rnorm</span>(<span class="dv">4</span>, <span class="dv">50</span>, <span class="dv">5</span>),</span>
<span id="cb29-8"><a href="data-reading-wrangling-and-writing.html#cb29-8"></a>                      <span class="dt">post_1=</span><span class="kw">rnorm</span>(<span class="dv">4</span>, <span class="dv">50</span>, <span class="dv">5</span>),</span>
<span id="cb29-9"><a href="data-reading-wrangling-and-writing.html#cb29-9"></a>                      <span class="dt">post_2=</span><span class="kw">rnorm</span>(<span class="dv">4</span>, <span class="dv">50</span>, <span class="dv">5</span>),</span>
<span id="cb29-10"><a href="data-reading-wrangling-and-writing.html#cb29-10"></a>                      <span class="dt">post_3=</span><span class="kw">rnorm</span>(<span class="dv">4</span>, <span class="dv">50</span>, <span class="dv">5</span>)</span>
<span id="cb29-11"><a href="data-reading-wrangling-and-writing.html#cb29-11"></a>                      )</span>
<span id="cb29-12"><a href="data-reading-wrangling-and-writing.html#cb29-12"></a>knitr<span class="op">::</span><span class="kw">kable</span>(fd_wide, <span class="dt">digits=</span><span class="dv">1</span>)</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">fish_ID</th>
<th align="left">treatment</th>
<th align="right">length</th>
<th align="right">pre_1</th>
<th align="right">pre_2</th>
<th align="right">pre_3</th>
<th align="right">post_1</th>
<th align="right">post_2</th>
<th align="right">post_3</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">fish1</td>
<td align="left">cn</td>
<td align="right">10.7</td>
<td align="right">51.6</td>
<td align="right">52.9</td>
<td align="right">46.9</td>
<td align="right">49.9</td>
<td align="right">54.6</td>
<td align="right">53.1</td>
</tr>
<tr class="even">
<td align="left">fish2</td>
<td align="left">cn</td>
<td align="right">12.4</td>
<td align="right">45.9</td>
<td align="right">48.5</td>
<td align="right">38.9</td>
<td align="right">54.7</td>
<td align="right">53.9</td>
<td align="right">49.7</td>
</tr>
<tr class="odd">
<td align="left">fish3</td>
<td align="left">tr</td>
<td align="right">10.3</td>
<td align="right">52.4</td>
<td align="right">57.6</td>
<td align="right">55.6</td>
<td align="right">54.1</td>
<td align="right">50.4</td>
<td align="right">49.2</td>
</tr>
<tr class="even">
<td align="left">fish4</td>
<td align="left">tr</td>
<td align="right">15.2</td>
<td align="right">53.7</td>
<td align="right">51.9</td>
<td align="right">49.8</td>
<td align="right">53.0</td>
<td align="right">40.1</td>
<td align="right">42.6</td>
</tr>
</tbody>
</table>
<p>To analyze the response (post-treatment sprint) adjusted for pre-treatment sprint, the three pre-treatment sprint measures need to be stacked into a single column and the three post-treatment measures need to be stacked into a single column. This is easy using <code>melt</code> from the data.table package.</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="data-reading-wrangling-and-writing.html#cb30-1"></a>pre_cols &lt;-<span class="st"> </span><span class="kw">paste</span>(<span class="st">&quot;pre&quot;</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">3</span>, <span class="dt">sep=</span><span class="st">&quot;_&quot;</span>)</span>
<span id="cb30-2"><a href="data-reading-wrangling-and-writing.html#cb30-2"></a>post_cols &lt;-<span class="st"> </span><span class="kw">paste</span>(<span class="st">&quot;post&quot;</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">3</span>, <span class="dt">sep=</span><span class="st">&quot;_&quot;</span>)</span>
<span id="cb30-3"><a href="data-reading-wrangling-and-writing.html#cb30-3"></a>fd &lt;-<span class="st"> </span><span class="kw">melt</span>(fd_wide,</span>
<span id="cb30-4"><a href="data-reading-wrangling-and-writing.html#cb30-4"></a>           <span class="dt">id.vars=</span><span class="kw">c</span>(<span class="st">&quot;fish_ID&quot;</span>, <span class="st">&quot;treatment&quot;</span>, <span class="st">&quot;length&quot;</span>),</span>
<span id="cb30-5"><a href="data-reading-wrangling-and-writing.html#cb30-5"></a>           <span class="dt">measure.vars=</span><span class="kw">list</span>(pre_cols, post_cols),</span>
<span id="cb30-6"><a href="data-reading-wrangling-and-writing.html#cb30-6"></a>           <span class="dt">variable.name=</span><span class="st">&quot;Order&quot;</span>,</span>
<span id="cb30-7"><a href="data-reading-wrangling-and-writing.html#cb30-7"></a>           <span class="dt">value.name=</span><span class="kw">c</span>(<span class="st">&quot;sprint_pre&quot;</span>, <span class="st">&quot;sprint_post&quot;</span>))</span>
<span id="cb30-8"><a href="data-reading-wrangling-and-writing.html#cb30-8"></a>knitr<span class="op">::</span><span class="kw">kable</span>(fd, <span class="dt">digits=</span><span class="dv">1</span>)</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">fish_ID</th>
<th align="left">treatment</th>
<th align="right">length</th>
<th align="left">Order</th>
<th align="right">sprint_pre</th>
<th align="right">sprint_post</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">fish1</td>
<td align="left">cn</td>
<td align="right">10.7</td>
<td align="left">1</td>
<td align="right">51.6</td>
<td align="right">49.9</td>
</tr>
<tr class="even">
<td align="left">fish2</td>
<td align="left">cn</td>
<td align="right">12.4</td>
<td align="left">1</td>
<td align="right">45.9</td>
<td align="right">54.7</td>
</tr>
<tr class="odd">
<td align="left">fish3</td>
<td align="left">tr</td>
<td align="right">10.3</td>
<td align="left">1</td>
<td align="right">52.4</td>
<td align="right">54.1</td>
</tr>
<tr class="even">
<td align="left">fish4</td>
<td align="left">tr</td>
<td align="right">15.2</td>
<td align="left">1</td>
<td align="right">53.7</td>
<td align="right">53.0</td>
</tr>
<tr class="odd">
<td align="left">fish1</td>
<td align="left">cn</td>
<td align="right">10.7</td>
<td align="left">2</td>
<td align="right">52.9</td>
<td align="right">54.6</td>
</tr>
<tr class="even">
<td align="left">fish2</td>
<td align="left">cn</td>
<td align="right">12.4</td>
<td align="left">2</td>
<td align="right">48.5</td>
<td align="right">53.9</td>
</tr>
<tr class="odd">
<td align="left">fish3</td>
<td align="left">tr</td>
<td align="right">10.3</td>
<td align="left">2</td>
<td align="right">57.6</td>
<td align="right">50.4</td>
</tr>
<tr class="even">
<td align="left">fish4</td>
<td align="left">tr</td>
<td align="right">15.2</td>
<td align="left">2</td>
<td align="right">51.9</td>
<td align="right">40.1</td>
</tr>
<tr class="odd">
<td align="left">fish1</td>
<td align="left">cn</td>
<td align="right">10.7</td>
<td align="left">3</td>
<td align="right">46.9</td>
<td align="right">53.1</td>
</tr>
<tr class="even">
<td align="left">fish2</td>
<td align="left">cn</td>
<td align="right">12.4</td>
<td align="left">3</td>
<td align="right">38.9</td>
<td align="right">49.7</td>
</tr>
<tr class="odd">
<td align="left">fish3</td>
<td align="left">tr</td>
<td align="right">10.3</td>
<td align="left">3</td>
<td align="right">55.6</td>
<td align="right">49.2</td>
</tr>
<tr class="even">
<td align="left">fish4</td>
<td align="left">tr</td>
<td align="right">15.2</td>
<td align="left">3</td>
<td align="right">49.8</td>
<td align="right">42.6</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="reshaping-data-transpose-turning-the-columns-into-rows" class="section level3">
<h3><span class="header-section-number">2.3.2</span> Reshaping data – Transpose (turning the columns into rows)</h3>
<div id="transpose-pi3k-inhibitors-data" class="section level4">
<h4><span class="header-section-number">2.3.2.1</span> Transpose – PI3K inhibitors data</h4>
<p>Source: <a href="https://www.nature.com/articles/s41586-018-0343-4">Suppression of insulin feedback enhances the efficacy of PI3K inhibitors</a></p>
<p>Figure 3A of this publication is a plot of blood glucose level taken on the same individual mice from four treatment groups over six time periods. Data on a single variable such as blood glucose, taken on the same individual at multiple time points, are known as <strong>longitudial data</strong> but are often mistakenly called <strong>repeated measures data</strong>. There are mulitple ways to analyze longitudinal data, some goood, some less good. There are two reasonable ways to archive longitudinal data for analysis in R. The Excel-archived data for Figure 3A is neither. A screen capture of two of the four treatment groups is shown below.</p>
<p><img src="images/pi3k-inhibitors.png" width="60%" /></p>
<p>In the archived data the individual mice are in columns. The measure at each time point is in rows. And the treatment group is in blocks. Typical data for analysis in R should have the individual mice in rows and each variable in columns (an exception in experimental biology is omics data, such as RNA expression levels. Many packages with functions to analyze these data have the genes on each row and the individual on each column). The Figure 3A data are turned on its side. We need to <strong>transpose</strong> the data, or rotate the matrix 90 degrees (make the columns rows and the rows columns) to turn the data into wide format. From this we can create a new data.table with the data in long format.</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="data-reading-wrangling-and-writing.html#cb31-1"></a>folder &lt;-<span class="st"> &quot;Suppression of insulin feedback enhances the efficacy of PI3K inhibitors&quot;</span></span>
<span id="cb31-2"><a href="data-reading-wrangling-and-writing.html#cb31-2"></a>filename &lt;-<span class="st"> &quot;41586_2018_343_MOESM6_ESM.xlsx&quot;</span></span>
<span id="cb31-3"><a href="data-reading-wrangling-and-writing.html#cb31-3"></a>file_path &lt;-<span class="st"> </span><span class="kw">here</span>(data_folder, folder, filename)</span>
<span id="cb31-4"><a href="data-reading-wrangling-and-writing.html#cb31-4"></a>pi3k_side &lt;-<span class="st"> </span><span class="kw">read_excel</span>(file_path,</span>
<span id="cb31-5"><a href="data-reading-wrangling-and-writing.html#cb31-5"></a>                    <span class="dt">sheet =</span> <span class="st">&quot;Figure 3A (Blood Glucose)&quot;</span>,</span>
<span id="cb31-6"><a href="data-reading-wrangling-and-writing.html#cb31-6"></a>                    <span class="dt">range =</span> <span class="st">&quot;A2:U7&quot;</span>,</span>
<span id="cb31-7"><a href="data-reading-wrangling-and-writing.html#cb31-7"></a>                    <span class="dt">col_names =</span> <span class="ot">FALSE</span>) <span class="op">%&gt;%</span></span>
<span id="cb31-8"><a href="data-reading-wrangling-and-writing.html#cb31-8"></a><span class="st">  </span><span class="kw">data.table</span>()</span></code></pre></div>
<pre><code>## New names:
## * `` -&gt; ...1
## * `` -&gt; ...2
## * `` -&gt; ...3
## * `` -&gt; ...4
## * `` -&gt; ...5
## * ...</code></pre>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="data-reading-wrangling-and-writing.html#cb33-1"></a><span class="co"># give columns names as the treatment of each mouse</span></span>
<span id="cb33-2"><a href="data-reading-wrangling-and-writing.html#cb33-2"></a><span class="co"># verify n=5 per group</span></span>
<span id="cb33-3"><a href="data-reading-wrangling-and-writing.html#cb33-3"></a>treatment_levels &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Chow&quot;</span>, <span class="st">&quot;Ketogenic&quot;</span>, <span class="st">&quot;Metformin&quot;</span>, <span class="st">&quot;SGLT2i&quot;</span>)</span>
<span id="cb33-4"><a href="data-reading-wrangling-and-writing.html#cb33-4"></a><span class="kw">colnames</span>(pi3k_side) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;time&quot;</span>,</span>
<span id="cb33-5"><a href="data-reading-wrangling-and-writing.html#cb33-5"></a>                         <span class="kw">rep</span>(treatment_levels, <span class="dt">each =</span> <span class="dv">5</span>))</span>
<span id="cb33-6"><a href="data-reading-wrangling-and-writing.html#cb33-6"></a></span>
<span id="cb33-7"><a href="data-reading-wrangling-and-writing.html#cb33-7"></a><span class="co"># transpose</span></span>
<span id="cb33-8"><a href="data-reading-wrangling-and-writing.html#cb33-8"></a><span class="co"># keep colnames in &quot;side&quot; as values of treatment col in &quot;wide&quot;</span></span>
<span id="cb33-9"><a href="data-reading-wrangling-and-writing.html#cb33-9"></a><span class="co"># make values of &quot;time&quot; in &quot;side&quot; the colnames in &quot;wide&quot;</span></span>
<span id="cb33-10"><a href="data-reading-wrangling-and-writing.html#cb33-10"></a>pi3k_wide &lt;-<span class="st"> </span><span class="kw">transpose</span>(pi3k_side,</span>
<span id="cb33-11"><a href="data-reading-wrangling-and-writing.html#cb33-11"></a>                       <span class="dt">keep.names =</span> <span class="st">&quot;treatment&quot;</span>, </span>
<span id="cb33-12"><a href="data-reading-wrangling-and-writing.html#cb33-12"></a>                       <span class="dt">make.names =</span> <span class="st">&quot;time&quot;</span>)</span>
<span id="cb33-13"><a href="data-reading-wrangling-and-writing.html#cb33-13"></a></span>
<span id="cb33-14"><a href="data-reading-wrangling-and-writing.html#cb33-14"></a><span class="co"># make a baseline column </span></span>
<span id="cb33-15"><a href="data-reading-wrangling-and-writing.html#cb33-15"></a>pi3k_wide[, glucose_<span class="dv">0</span> <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">get</span>(<span class="st">&quot;0&quot;</span>)]</span>
<span id="cb33-16"><a href="data-reading-wrangling-and-writing.html#cb33-16"></a></span>
<span id="cb33-17"><a href="data-reading-wrangling-and-writing.html#cb33-17"></a><span class="co"># make-up a mouse id for each mouse</span></span>
<span id="cb33-18"><a href="data-reading-wrangling-and-writing.html#cb33-18"></a>pi3k_wide[, id <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">paste</span>(treatment, <span class="dv">1</span><span class="op">:</span>.N, <span class="dt">sep =</span> <span class="st">&quot;_&quot;</span>), by =<span class="st"> </span>treatment]</span>
<span id="cb33-19"><a href="data-reading-wrangling-and-writing.html#cb33-19"></a></span>
<span id="cb33-20"><a href="data-reading-wrangling-and-writing.html#cb33-20"></a><span class="co"># make treatement a factor with &quot;chow&quot; as reference</span></span>
<span id="cb33-21"><a href="data-reading-wrangling-and-writing.html#cb33-21"></a>pi3k_wide[, treatment <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">factor</span>(treatment, treatment_levels)]</span>
<span id="cb33-22"><a href="data-reading-wrangling-and-writing.html#cb33-22"></a></span>
<span id="cb33-23"><a href="data-reading-wrangling-and-writing.html#cb33-23"></a><span class="co"># make a long version</span></span>
<span id="cb33-24"><a href="data-reading-wrangling-and-writing.html#cb33-24"></a>pi3k_long &lt;-<span class="st"> </span><span class="kw">melt</span>(pi3k_wide,</span>
<span id="cb33-25"><a href="data-reading-wrangling-and-writing.html#cb33-25"></a>                  <span class="dt">id.vars =</span> <span class="kw">c</span>(<span class="st">&quot;treatment&quot;</span>, <span class="st">&quot;id&quot;</span>, <span class="st">&quot;glucose_0&quot;</span>),</span>
<span id="cb33-26"><a href="data-reading-wrangling-and-writing.html#cb33-26"></a>                  <span class="dt">variable.name =</span> <span class="st">&quot;time&quot;</span>,</span>
<span id="cb33-27"><a href="data-reading-wrangling-and-writing.html#cb33-27"></a>                  <span class="dt">value.name =</span> <span class="st">&quot;glucose&quot;</span>)</span></code></pre></div>
<p>Notes</p>
<ol style="list-style-type: decimal">
<li>Read the comments on the usage of the <code>keep.names</code> and <code>make.names</code> arguments of <code>transpose</code>. These are powerful.</li>
<li>pi3k_wide has column names that are times (in minutes). This presents wrangling problems (column names shouldn’t be numbers. Here it is useful to create the long format data.table with a time column of numbers). For example, the code above creates copies the column “0” into a new column “glucose_0” using <code>glucose_0 := get("0")</code>. Had the code been <code>glucose_0 := "0"</code>, all values would be the character “0”. Had the code been <code>glucose_0 := 0</code>, all values would be the number 0. <code>get</code> looks for the column with the name of whatever is inside the parentheses.</li>
</ol>
<p>Let’s do a quick plot to examine the data</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="data-reading-wrangling-and-writing.html#cb34-1"></a><span class="kw">qplot</span>(<span class="dt">x =</span> time,</span>
<span id="cb34-2"><a href="data-reading-wrangling-and-writing.html#cb34-2"></a>      <span class="dt">y =</span> glucose,</span>
<span id="cb34-3"><a href="data-reading-wrangling-and-writing.html#cb34-3"></a>      <span class="dt">data =</span> pi3k_long,</span>
<span id="cb34-4"><a href="data-reading-wrangling-and-writing.html#cb34-4"></a>      <span class="dt">color =</span> treatment) <span class="op">+</span></span>
<span id="cb34-5"><a href="data-reading-wrangling-and-writing.html#cb34-5"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">group =</span> id))</span></code></pre></div>
<p><img src="Walker-elementary-statistical-modeling-draft_files/figure-html/unnamed-chunk-24-1.png" width="576" /></p>
</div>
</div>
<div id="combining-data" class="section level3">
<h3><span class="header-section-number">2.3.3</span> Combining data</h3>
<p><strong>Source article</strong> Bak, A.M., Vendelbo, M.H., Christensen, B., Viggers, R., Bibby, B.M., Rungby, J., Jørgensen, J.O.L., Møller, N. and Jessen, N., 2018. Prolonged fasting-induced metabolic signatures in human skeletal muscle of lean and obese men. PloS one, 13(9), p.e0200817.</p>
<p><strong>Data source</strong> <a href="https://datadryad.org/stash/dataset/doi:10.5061/dryad.6121hj7" class="uri">https://datadryad.org/stash/dataset/doi:10.5061/dryad.6121hj7</a></p>
<p><strong>file name</strong>: datafiles.xlsx</p>
<p>The data are from a randomized <strong>crossover</strong> design where 18 men (9 lean and 9 obese) were measured for multiple metabolic markers at two times: 1) in a post-absorptive state after 12 hours overnight fast, and 2) in a prolonged fasting state after 72 hours of fasting. In addition, at each time point, metabolic markers were measured prior to and after an insulin infusion. Here, we want to reproduce values in Table 2, which are measures of mean blood insulin and metabolite levels after 12 hours and 72 hours fasting in both the lean and obese groups.</p>
<p>A difficulty for the analyst is that the response data are in the “Table 2” sheet but the variable containing the assignment to “lean” or “obese” group is in the “Table 1” sheet. To analyze these response, the two datasets need to be combined into a single data frame. The important consideration when combining data is that <em>like is matched with like</em>. For the fasting dataset, “like” is the subject id, and we have some data for each subject id in Table 1 and other data for the same subject ids in Table 2. This means that we essentially want to glue the columns of table 2 to the columns of table 1 in a way that insures that the correct data for each subject id is on the same row. This is a bit more complicated for these data because Table 1 contains 18 data rows, one for each subject id and Table 2 contains 36 data rows, 2 for each subject id, because each subject has data measured at 12 hours and at 72 hours.</p>
</div>
<div id="subsetting-data" class="section level3">
<h3><span class="header-section-number">2.3.4</span> Subsetting data</h3>
<p>It is common to see researchers create multiple subsets of data for further processing. This practice should be be discouraged because the same variables will be in multiple data frames and it can be hard to keep track of any processing of variables in the different datasets. Instead, subset the data at the level of analysis.</p>
<p>There are many ways to subset data in R. Experienced users tend to divide up into those using base R, those using the tidyverse packages, or those using data.table. Learn one well. This book uses data.table. Before outlining usage in data.table, let’s back up a bit and review different <em>indexing</em> systems.</p>
<ul>
<li>In Excel, rows are specified (or “indexed”) by numbers and columns by letters. Every cell has an address, for example C2 is the cell in the 2nd row and 3rd column. Notice that in Excel, the column part of the address comes before the row part.</li>
<li>In statistics, it is extremely common to use a system where <span class="math inline">\(x_{ij}\)</span> is the value of the element in the <em>i</em>th row and <em>j</em>th column of the matrix <strong>X</strong>. Notice that in this notatin, the row index (<em>i</em>) comes before the column index (<em>j</em>).</li>
<li>In programming languages, including R, it is extremely common to use a system where my_data[i, j] is the value of the element in the <em>i</em>th row and <em>j</em>th column of the matrix-like object named “my_data” (such as a data frame in R).</li>
<li>data.table explicitly refers to the row index and column index as <em>i</em> and <em>j</em>.</li>
</ul>
<div id="specifying-a-subset-of-rows-observations-or-cases" class="section level4">
<h4><span class="header-section-number">2.3.4.1</span> Specifying a subset of rows (“observations” or “cases”)</h4>
<p>A subset of rows is specified using either a list of row numbers or</p>
<p>In a data.table, a subset of rows is specified using either a list of row numbers or a combination of comparison operators (==, !=, &gt;, &lt;, &gt;=, &lt;=, %in%) and Boolean logic operators (&amp;, |, ! – these are “and”, “or”, “not”) as <em>i</em>.</p>
<p>Let’s use the pi3k_long data from above to explore this. First, the plot of plasma glucose for all individuals in each treatment group across all time points.</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="data-reading-wrangling-and-writing.html#cb35-1"></a><span class="kw">qplot</span>(<span class="dt">x =</span> time,</span>
<span id="cb35-2"><a href="data-reading-wrangling-and-writing.html#cb35-2"></a>      <span class="dt">y =</span> glucose,</span>
<span id="cb35-3"><a href="data-reading-wrangling-and-writing.html#cb35-3"></a>      <span class="dt">data =</span> pi3k_long,</span>
<span id="cb35-4"><a href="data-reading-wrangling-and-writing.html#cb35-4"></a>      <span class="dt">color =</span> treatment) <span class="op">+</span></span>
<span id="cb35-5"><a href="data-reading-wrangling-and-writing.html#cb35-5"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">group =</span> id))</span></code></pre></div>
<p><img src="Walker-elementary-statistical-modeling-draft_files/figure-html/unnamed-chunk-25-1.png" width="576" /></p>
<p><code>pi3k_long[treatment == "Chow",])</code> is the subset of rows in which entries in the column “treatment” take the value “Chow” using the “is equal” (“==”) operator</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="data-reading-wrangling-and-writing.html#cb36-1"></a><span class="kw">qplot</span>(<span class="dt">x =</span> time,</span>
<span id="cb36-2"><a href="data-reading-wrangling-and-writing.html#cb36-2"></a>      <span class="dt">y =</span> glucose,</span>
<span id="cb36-3"><a href="data-reading-wrangling-and-writing.html#cb36-3"></a>      <span class="dt">data =</span> pi3k_long[treatment <span class="op">==</span><span class="st"> &quot;Chow&quot;</span>,],</span>
<span id="cb36-4"><a href="data-reading-wrangling-and-writing.html#cb36-4"></a>      <span class="dt">color =</span> treatment) <span class="op">+</span></span>
<span id="cb36-5"><a href="data-reading-wrangling-and-writing.html#cb36-5"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">group =</span> id))</span></code></pre></div>
<p><img src="Walker-elementary-statistical-modeling-draft_files/figure-html/unnamed-chunk-26-1.png" width="576" /></p>
<p>And the subset of rows in which entries in the column “treatment” take any value but “Chow” using the “not equal” operator (“!=”).</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="data-reading-wrangling-and-writing.html#cb37-1"></a><span class="kw">qplot</span>(<span class="dt">x =</span> time,</span>
<span id="cb37-2"><a href="data-reading-wrangling-and-writing.html#cb37-2"></a>      <span class="dt">y =</span> glucose,</span>
<span id="cb37-3"><a href="data-reading-wrangling-and-writing.html#cb37-3"></a>      <span class="dt">data =</span> pi3k_long[treatment <span class="op">!=</span><span class="st"> &quot;Chow&quot;</span>,],</span>
<span id="cb37-4"><a href="data-reading-wrangling-and-writing.html#cb37-4"></a>      <span class="dt">color =</span> treatment) <span class="op">+</span></span>
<span id="cb37-5"><a href="data-reading-wrangling-and-writing.html#cb37-5"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">group =</span> id))</span></code></pre></div>
<p><img src="Walker-elementary-statistical-modeling-draft_files/figure-html/unnamed-chunk-27-1.png" width="576" /></p>
<p>The subset of rows in which entries in the column “treatment” take either the value “Chow” or the value “SGLT2i” by combining two “is equal” (“==”) operators using the OR (“|”) boolean operator</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="data-reading-wrangling-and-writing.html#cb38-1"></a><span class="kw">qplot</span>(<span class="dt">x =</span> time,</span>
<span id="cb38-2"><a href="data-reading-wrangling-and-writing.html#cb38-2"></a>      <span class="dt">y =</span> glucose,</span>
<span id="cb38-3"><a href="data-reading-wrangling-and-writing.html#cb38-3"></a>      <span class="dt">data =</span> pi3k_long[treatment <span class="op">==</span><span class="st"> &quot;Chow&quot;</span> <span class="op">|</span><span class="st"> </span>treatment <span class="op">==</span><span class="st"> &quot;SGLT2i&quot;</span>,],</span>
<span id="cb38-4"><a href="data-reading-wrangling-and-writing.html#cb38-4"></a>      <span class="dt">color =</span> treatment) <span class="op">+</span></span>
<span id="cb38-5"><a href="data-reading-wrangling-and-writing.html#cb38-5"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">group =</span> id))</span></code></pre></div>
<p><img src="Walker-elementary-statistical-modeling-draft_files/figure-html/unnamed-chunk-28-1.png" width="576" /></p>
<p>The subset of rows in which entries in the column “time” take either the value “30” or the value “60” using the “in a list” operator (%in%). The values in the “time” column look like integers but are actually treatment levels (which act like string or character variables).</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="data-reading-wrangling-and-writing.html#cb39-1"></a><span class="kw">qplot</span>(<span class="dt">x =</span> time,</span>
<span id="cb39-2"><a href="data-reading-wrangling-and-writing.html#cb39-2"></a>      <span class="dt">y =</span> glucose,</span>
<span id="cb39-3"><a href="data-reading-wrangling-and-writing.html#cb39-3"></a>      <span class="dt">data =</span> pi3k_long[time  <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;30&quot;</span>, <span class="st">&quot;60&quot;</span>),],</span>
<span id="cb39-4"><a href="data-reading-wrangling-and-writing.html#cb39-4"></a>      <span class="dt">color =</span> treatment) <span class="op">+</span></span>
<span id="cb39-5"><a href="data-reading-wrangling-and-writing.html#cb39-5"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">group =</span> id))</span></code></pre></div>
<p><img src="Walker-elementary-statistical-modeling-draft_files/figure-html/unnamed-chunk-29-1.png" width="576" /></p>
<p>The subset of rows in which entries in the column “time_c” are less than or equal to 60 using the “less than or equal to” operator AND the value in the treatment column is in the list (“Chow”, “SGLT2i”). The two comparisons are combined with the AND (“&amp;”) Boolean operator.</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="data-reading-wrangling-and-writing.html#cb40-1"></a>pi3k_long[, time_c <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">as.numeric</span>(<span class="kw">as.character</span>(time))]</span>
<span id="cb40-2"><a href="data-reading-wrangling-and-writing.html#cb40-2"></a><span class="kw">qplot</span>(<span class="dt">x =</span> time,</span>
<span id="cb40-3"><a href="data-reading-wrangling-and-writing.html#cb40-3"></a>      <span class="dt">y =</span> glucose,</span>
<span id="cb40-4"><a href="data-reading-wrangling-and-writing.html#cb40-4"></a>      <span class="dt">data =</span> pi3k_long[time_c <span class="op">&lt;=</span><span class="st"> </span><span class="dv">30</span> <span class="op">&amp;</span><span class="st"> </span>treatment <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Chow&quot;</span>, <span class="st">&quot;SGLT2i&quot;</span>),],</span>
<span id="cb40-5"><a href="data-reading-wrangling-and-writing.html#cb40-5"></a>      <span class="dt">color =</span> treatment) <span class="op">+</span></span>
<span id="cb40-6"><a href="data-reading-wrangling-and-writing.html#cb40-6"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">group =</span> id))</span></code></pre></div>
<p><img src="Walker-elementary-statistical-modeling-draft_files/figure-html/unnamed-chunk-30-1.png" width="576" /></p>
<p>The same result as above but using different operators. I would describe this as, the subset of rows in which entries in the column “time_c” are less than or equal to 60 using the “less than or equal to” operator AND the value in the treatment column is either “Chow” OR “SGLT2i”. The two comparisons are combined with the AND (“&amp;”) Boolean operator. The order of operations is determined by the parentheses, as with all algebra.</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="data-reading-wrangling-and-writing.html#cb41-1"></a>pi3k_long[, time_c <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">as.numeric</span>(<span class="kw">as.character</span>(time))]</span>
<span id="cb41-2"><a href="data-reading-wrangling-and-writing.html#cb41-2"></a><span class="kw">qplot</span>(<span class="dt">x =</span> time,</span>
<span id="cb41-3"><a href="data-reading-wrangling-and-writing.html#cb41-3"></a>      <span class="dt">y =</span> glucose,</span>
<span id="cb41-4"><a href="data-reading-wrangling-and-writing.html#cb41-4"></a>      <span class="dt">data =</span> pi3k_long[time_c <span class="op">&lt;=</span><span class="st"> </span><span class="dv">30</span> <span class="op">&amp;</span><span class="st"> </span>(treatment <span class="op">==</span><span class="st"> &quot;Chow&quot;</span> <span class="op">|</span><span class="st"> </span>treatment <span class="op">==</span><span class="st"> &quot;SGLT2i&quot;</span>),],</span>
<span id="cb41-5"><a href="data-reading-wrangling-and-writing.html#cb41-5"></a>      <span class="dt">color =</span> treatment) <span class="op">+</span></span>
<span id="cb41-6"><a href="data-reading-wrangling-and-writing.html#cb41-6"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">group =</span> id))</span></code></pre></div>
<p><img src="Walker-elementary-statistical-modeling-draft_files/figure-html/unnamed-chunk-31-1.png" width="576" /></p>
</div>
</div>
<div id="wrangling-columns" class="section level3">
<h3><span class="header-section-number">2.3.5</span> Wrangling columns</h3>
<div id="creating-new-columns-that-are-functions-of-values-in-existing-columnes" class="section level4">
<h4><span class="header-section-number">2.3.5.1</span> Creating new columns that are functions of values in existing columnes</h4>
</div>
<div id="change-the-reference-level-of-a-factor" class="section level4">
<h4><span class="header-section-number">2.3.5.2</span> Change the reference level of a factor</h4>
</div>
<div id="converting-a-single-column-with-all-combinations-of-a-2-x-2-factorial-experiment-into-two-columns-each-containing-the-two-levels-of-a-factor" class="section level4">
<h4><span class="header-section-number">2.3.5.3</span> Converting a single column with all combinations of a 2 x 2 factorial experiment into two columns, each containing the two levels of a factor</h4>
<p><strong>Article source</strong>: Tauriello, D., Palomo-Ponce, S., Stork, D. et al. TGFβ drives immune evasion in genetically reconstituted colon cancer metastasis. Nature 554, 538–543 (2018) <a href="doi:10.1038/nature25492" class="uri">doi:10.1038/nature25492</a></p>
<p><strong>Data source</strong>: <a href="https://www.nature.com/articles/nature25492#Sec23" class="uri">https://www.nature.com/articles/nature25492#Sec23</a></p>
<p>filename: “41586_2018_BFnature25492_MOESM10_ESM.xlsx”</p>
<p>sheet: “Fig. 4h-tumours”</p>
<p>The analysis of the data in Fig. 4h specifies a single <span class="math inline">\(X\)</span> variable “Treatment” with four levels (or groups): “Con”, “Gal”, “aPD-L1”, and “Gal+aPD-L1”. These levels indicate that the design is actually <strong>factorial</strong> with two factors, each with two levels. The first factor has levels “no Gal” and “Gal”. The second factor has levels “no aPD-L1”, “aPD-L1”. The single column Treatment “flattens” the 2 X 2 factorial design to a 4 x 1 design. In general, we would want to analyze an experiment like this as factorial model, because this allows us to make inferences about the <em>interaction effect</em> between the two factors. For these inferences, we need a standard error, or a confidence interval, or a <em>p</em>-value of the estimate, which we can easily get from the factorial model. In order to analyze the data with a factorial model, we need to create two new columns – one column is the factor variable containing the two levels of Gal and one column is the factor variable containing the two levels of aPD-L1.</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="data-reading-wrangling-and-writing.html#cb42-1"></a>gal_levels &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;no Gal&quot;</span>, <span class="st">&quot;Gal&quot;</span>)</span>
<span id="cb42-2"><a href="data-reading-wrangling-and-writing.html#cb42-2"></a>tumor[, gal <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">ifelse</span>(treatment <span class="op">==</span><span class="st"> &quot;Gal&quot;</span> <span class="op">|</span><span class="st"> </span>treatment <span class="op">==</span><span class="st"> &quot;Gal+aPD-L1&quot;</span>,</span>
<span id="cb42-3"><a href="data-reading-wrangling-and-writing.html#cb42-3"></a>                      gal_levels[<span class="dv">2</span>],</span>
<span id="cb42-4"><a href="data-reading-wrangling-and-writing.html#cb42-4"></a>                      gal_levels[<span class="dv">1</span>])]</span>
<span id="cb42-5"><a href="data-reading-wrangling-and-writing.html#cb42-5"></a></span>
<span id="cb42-6"><a href="data-reading-wrangling-and-writing.html#cb42-6"></a>apd_levels &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;no aPD-L1&quot;</span>, <span class="st">&quot;aPD-L1&quot;</span>)</span>
<span id="cb42-7"><a href="data-reading-wrangling-and-writing.html#cb42-7"></a>tumor[, apdl1 <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">ifelse</span>(treatment <span class="op">==</span><span class="st"> &quot;aPD-L1&quot;</span> <span class="op">|</span><span class="st"> </span>treatment <span class="op">==</span><span class="st"> &quot;Gal+aPD-L1&quot;</span>,</span>
<span id="cb42-8"><a href="data-reading-wrangling-and-writing.html#cb42-8"></a>                      apd_levels[<span class="dv">2</span>],</span>
<span id="cb42-9"><a href="data-reading-wrangling-and-writing.html#cb42-9"></a>                      apd_levels[<span class="dv">1</span>])]</span>
<span id="cb42-10"><a href="data-reading-wrangling-and-writing.html#cb42-10"></a></span>
<span id="cb42-11"><a href="data-reading-wrangling-and-writing.html#cb42-11"></a><span class="co"># re-order factor levels</span></span>
<span id="cb42-12"><a href="data-reading-wrangling-and-writing.html#cb42-12"></a>tumor[, gal<span class="op">:</span><span class="er">=</span><span class="kw">factor</span>(gal, gal_levels)]</span>
<span id="cb42-13"><a href="data-reading-wrangling-and-writing.html#cb42-13"></a>tumor[, apdl1<span class="op">:</span><span class="er">=</span><span class="kw">factor</span>(apdl1, apd_levels)]</span></code></pre></div>
<p>A way to check the results to make sure that our conversion is correct is to compute the sampel size for the 2 x 2 combinations, but include the original treatment column in the <code>by</code> list.</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="data-reading-wrangling-and-writing.html#cb43-1"></a>tumor[<span class="op">!</span><span class="kw">is.na</span>(num_positive_per_mm), .(<span class="dt">N=</span>.N), by=.(treatment, gal, apdl1)]</span></code></pre></div>
<pre><code>##     treatment    gal     apdl1   N
## 1:        Con no Gal no aPD-L1 124
## 2:        Gal    Gal no aPD-L1  89
## 3:     aPD-L1 no Gal    aPD-L1 101
## 4: Gal+aPD-L1    Gal    aPD-L1  58</code></pre>
<p>That looks good.</p>
<p><strong>Bug alert</strong> If you break Rule #1, and type in the treatment level “Gal+aPD-L1” as “Gal + aPD-L1”, then you will get new columns containing junk.</p>
<pre><code>##     treatment    gal     apdl1   N
## 1:        Con no Gal no aPD-L1 124
## 2:        Gal    Gal no aPD-L1  89
## 3:     aPD-L1 no Gal    aPD-L1 101
## 4: Gal+aPD-L1 no Gal no aPD-L1  58</code></pre>
<p>Remember Rule #1. Always copy and paste any text that will be inserted into quotes. This is easily done here by typing <code>unique(tumor$treatment)</code> into the console. This function returns the unique values of the column “treatment” of the data.table “tumor”.</p>
<blockquote>
<p>unique(tumor$treatment)
[1] “Con” “Gal” “aPD-L1” “Gal+aPD-L1”</p>
</blockquote>
<p>Now, copy the name of a level and paste into your code. Repeat until done.</p>
</div>
</div>
<div id="missing-data" class="section level3">
<h3><span class="header-section-number">2.3.6</span> Missing data</h3>
<p>Source: <a href="https://journals.plos.org/plosgenetics/article?id=10.1371/journal.pgen.1008002&amp;rev=1">Deletion of Cdkn1b in ACI rats leads to increased proliferation and pregnancy-associated changes in the mammary gland due to perturbed systemic endocrine environment</a></p>
<p>Supplement Figure 1F of this paper shows weight as a function of age class and genotype for the whole body and 8 organs. There are some missing weights in the Excel-archived data. These missing data are designated with a minus “-” sign. To import these data in correctly, use the <code>na =</code> argument in the <code>read_excel</code> function.</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="data-reading-wrangling-and-writing.html#cb46-1"></a>file_folder &lt;-<span class="st"> &quot;Deletion of Cdkn1b in ACI rats leads to increased proliferation and pregnancy-associated changes in the mammary gland due to perturbed systemic endocrine environment&quot;</span></span>
<span id="cb46-2"><a href="data-reading-wrangling-and-writing.html#cb46-2"></a>file_name &lt;-<span class="st"> &quot;journal.pgen.1008002.s008.xlsx&quot;</span></span>
<span id="cb46-3"><a href="data-reading-wrangling-and-writing.html#cb46-3"></a>file_path &lt;-<span class="st"> </span><span class="kw">here</span>(data_folder, file_folder, file_name)</span>
<span id="cb46-4"><a href="data-reading-wrangling-and-writing.html#cb46-4"></a>  </span>
<span id="cb46-5"><a href="data-reading-wrangling-and-writing.html#cb46-5"></a>fig_s1f &lt;-<span class="st"> </span><span class="kw">read_excel</span>(file_path,</span>
<span id="cb46-6"><a href="data-reading-wrangling-and-writing.html#cb46-6"></a>                    <span class="dt">sheet =</span> <span class="st">&quot;all weights&quot;</span>,</span>
<span id="cb46-7"><a href="data-reading-wrangling-and-writing.html#cb46-7"></a>                    <span class="dt">range =</span> <span class="st">&quot;A2:K57&quot;</span>,</span>
<span id="cb46-8"><a href="data-reading-wrangling-and-writing.html#cb46-8"></a>                    <span class="dt">na =</span> <span class="st">&quot;-&quot;</span>,</span>
<span id="cb46-9"><a href="data-reading-wrangling-and-writing.html#cb46-9"></a>                    <span class="dt">col_names =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span></span>
<span id="cb46-10"><a href="data-reading-wrangling-and-writing.html#cb46-10"></a><span class="st">  </span><span class="kw">clean_names</span>() <span class="op">%&gt;%</span></span>
<span id="cb46-11"><a href="data-reading-wrangling-and-writing.html#cb46-11"></a><span class="st">  </span><span class="kw">data.table</span>()</span>
<span id="cb46-12"><a href="data-reading-wrangling-and-writing.html#cb46-12"></a></span>
<span id="cb46-13"><a href="data-reading-wrangling-and-writing.html#cb46-13"></a>fig_s1f[, genotype <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">factor</span>(genotype, <span class="kw">c</span>(<span class="st">&quot;+/+&quot;</span>, <span class="st">&quot;-/-&quot;</span>))]</span>
<span id="cb46-14"><a href="data-reading-wrangling-and-writing.html#cb46-14"></a>fig_s1f[, age_class <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">ifelse</span>(age_at_sac_wks <span class="op">&lt;=</span><span class="st"> </span><span class="fl">6.0</span>, <span class="st">&quot;4-6&quot;</span>, <span class="st">&quot;8+&quot;</span>)]</span>
<span id="cb46-15"><a href="data-reading-wrangling-and-writing.html#cb46-15"></a></span>
<span id="cb46-16"><a href="data-reading-wrangling-and-writing.html#cb46-16"></a><span class="co"># View(fig_s1f)</span></span></code></pre></div>
<p>Notes</p>
<ol style="list-style-type: decimal">
<li>In R, a value of “NA” represents missing.</li>
<li>The default value for <code>na =</code> is an empty (or blank) cell (not a space but a cell that is empty).</li>
<li><code>na =</code> accepts a list of strings, for example <code>na = c("", "-99", "--")</code> that will all be read as na.</li>
</ol>
<div id="handling-missing-data" class="section level4">
<h4><span class="header-section-number">2.3.6.1</span> Handling missing data</h4>
<div id="many-base-r-functions-used-for-summary-measures-require-na-handling" class="section level5">
<h5><span class="header-section-number">2.3.6.1.1</span> Many base R functions used for summary measures require NA handling</h5>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="data-reading-wrangling-and-writing.html#cb47-1"></a><span class="kw">mean</span>(fig_s1f[, ovary]) <span class="co"># returns &quot;NA&quot;</span></span></code></pre></div>
<pre><code>## [1] NA</code></pre>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="data-reading-wrangling-and-writing.html#cb49-1"></a><span class="kw">mean</span>(fig_s1f[, ovary], <span class="dt">na.rm =</span> <span class="ot">TRUE</span>) <span class="co"># returns the mean</span></span></code></pre></div>
<pre><code>## [1] 0.2489524</code></pre>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="data-reading-wrangling-and-writing.html#cb51-1"></a><span class="kw">sd</span>(fig_s1f[, ovary]) <span class="co"># returns &quot;NA&quot;</span></span></code></pre></div>
<pre><code>## [1] NA</code></pre>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="data-reading-wrangling-and-writing.html#cb53-1"></a><span class="kw">sd</span>(fig_s1f[, ovary], <span class="dt">na.rm =</span> <span class="ot">TRUE</span>) <span class="co"># returns the mean</span></span></code></pre></div>
<pre><code>## [1] 0.151694</code></pre>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="data-reading-wrangling-and-writing.html#cb55-1"></a><span class="kw">sum</span>(fig_s1f[, ovary]) <span class="co"># returns &quot;NA&quot;</span></span></code></pre></div>
<pre><code>## [1] NA</code></pre>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="data-reading-wrangling-and-writing.html#cb57-1"></a><span class="kw">sum</span>(fig_s1f[, ovary], <span class="dt">na.rm =</span> <span class="ot">TRUE</span>) <span class="co"># returns the mean</span></span></code></pre></div>
<pre><code>## [1] 10.456</code></pre>
<p>There are many ways to get the sample size for a particular variable. Be careful if using <code>length()</code> which counts NA as part of the vector of values.</p>
</div>
<div id="the-is.na-function-is-useful" class="section level5">
<h5><span class="header-section-number">2.3.6.1.2</span> The !is.na function is useful</h5>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="data-reading-wrangling-and-writing.html#cb59-1"></a><span class="kw">length</span>(fig_s1f[, ovary])</span></code></pre></div>
<pre><code>## [1] 55</code></pre>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="data-reading-wrangling-and-writing.html#cb61-1"></a><span class="kw">length</span>(fig_s1f[<span class="op">!</span><span class="kw">is.na</span>(ovary), ovary])</span></code></pre></div>
<pre><code>## [1] 42</code></pre>
<p>Notes</p>
<ol style="list-style-type: decimal">
<li><code>!is.na(ovary)</code> is taking the subset of rows of fig_s1f for which the value of “ovary” is not NA (!is.na is read “not is.na”)</li>
</ol>
<p>This is especially useful if you are creating your own code uses counts. Here I create a table of means, standard error of the mean, and 95% CIs of the mean for each genotype group. But first, this script generates the wrong N for each group (since there are missing values), although the mean and SD are correct.</p>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="data-reading-wrangling-and-writing.html#cb63-1"></a>fig_s1f[, .(<span class="dt">mean =</span> <span class="kw">mean</span>(spleen, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),</span>
<span id="cb63-2"><a href="data-reading-wrangling-and-writing.html#cb63-2"></a>            <span class="dt">n =</span> .N,</span>
<span id="cb63-3"><a href="data-reading-wrangling-and-writing.html#cb63-3"></a>            <span class="dt">sd =</span> <span class="kw">sd</span>(spleen, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)),</span>
<span id="cb63-4"><a href="data-reading-wrangling-and-writing.html#cb63-4"></a>        by =<span class="st"> </span>genotype]</span></code></pre></div>
<pre><code>##    genotype      mean  n         sd
## 1:      -/- 0.5801333 21 0.13680480
## 2:      +/+ 0.2956667 34 0.04460855</code></pre>
<p>To compute the correct <em>n</em>, which will be necessary for computing the SE and the CI, use <code>!is.na</code></p>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="data-reading-wrangling-and-writing.html#cb65-1"></a>spleen_summary &lt;-<span class="st"> </span>fig_s1f[<span class="op">!</span><span class="kw">is.na</span>(spleen), .(<span class="dt">mean =</span> <span class="kw">mean</span>(spleen),</span>
<span id="cb65-2"><a href="data-reading-wrangling-and-writing.html#cb65-2"></a>            <span class="dt">n =</span> .N,</span>
<span id="cb65-3"><a href="data-reading-wrangling-and-writing.html#cb65-3"></a>            <span class="dt">sd =</span> <span class="kw">sd</span>(spleen)),</span>
<span id="cb65-4"><a href="data-reading-wrangling-and-writing.html#cb65-4"></a>        by =<span class="st"> </span>genotype]</span>
<span id="cb65-5"><a href="data-reading-wrangling-and-writing.html#cb65-5"></a>spleen_summary[, se <span class="op">:</span><span class="er">=</span><span class="st"> </span>sd<span class="op">/</span><span class="kw">sqrt</span>(n)]</span>
<span id="cb65-6"><a href="data-reading-wrangling-and-writing.html#cb65-6"></a>spleen_summary[, lower <span class="op">:</span><span class="er">=</span><span class="st"> </span>mean <span class="op">+</span><span class="st"> </span>se<span class="op">*</span><span class="kw">qt</span>(.<span class="dv">025</span>, (n<span class="dv">-1</span>))]</span>
<span id="cb65-7"><a href="data-reading-wrangling-and-writing.html#cb65-7"></a>spleen_summary[, upper <span class="op">:</span><span class="er">=</span><span class="st"> </span>mean <span class="op">+</span><span class="st"> </span>se<span class="op">*</span><span class="kw">qt</span>(.<span class="dv">975</span>, (n<span class="dv">-1</span>))]</span>
<span id="cb65-8"><a href="data-reading-wrangling-and-writing.html#cb65-8"></a>spleen_summary</span></code></pre></div>
<pre><code>##    genotype      mean  n         sd         se     lower     upper
## 1:      -/- 0.5801333 15 0.13680480 0.03532285 0.5043734 0.6558933
## 2:      +/+ 0.2956667 27 0.04460855 0.00858492 0.2780201 0.3133132</code></pre>
</div>
<div id="ggplot-functions-automatically-handle-missing-values" class="section level5">
<h5><span class="header-section-number">2.3.6.1.3</span> ggplot functions automatically handle missing values</h5>
<p>with a useful warning.</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="data-reading-wrangling-and-writing.html#cb67-1"></a><span class="kw">qplot</span>(<span class="dt">x =</span> body_wt_g_sac,</span>
<span id="cb67-2"><a href="data-reading-wrangling-and-writing.html#cb67-2"></a>      <span class="dt">y =</span> spleen,</span>
<span id="cb67-3"><a href="data-reading-wrangling-and-writing.html#cb67-3"></a>      <span class="dt">color =</span> genotype,</span>
<span id="cb67-4"><a href="data-reading-wrangling-and-writing.html#cb67-4"></a>      <span class="dt">data =</span> fig_s1f)</span></code></pre></div>
<pre><code>## Warning: Removed 13 rows containing missing values (geom_point).</code></pre>
<p><img src="Walker-elementary-statistical-modeling-draft_files/figure-html/unnamed-chunk-41-1.png" width="576" /></p>
</div>
<div id="regression-model-functions-lm-glm-gls-etc.-handle-missing-values-by-default" class="section level5">
<h5><span class="header-section-number">2.3.6.1.4</span> Regression model functions (lm, glm, gls, etc.) handle missing values by default</h5>
<p>Missing data in regression model functions such as <code>lm</code> are handled using the argument <code>na.action =</code> and the default is “na.omit”, which omits any rows that contain a missing value in one or more of the model variables (it includes rows if these contain missing values only in the columns not included in the model). It’s as if the user took the subset of data including only the columns containing the model variables and then deleted any row with missing values.</p>
<p>Here is the coefficient table of the fit model object that did not explictly tell the <code>lm</code> function how to handle missing data.</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="data-reading-wrangling-and-writing.html#cb69-1"></a>m1 &lt;-<span class="st"> </span><span class="kw">lm</span>(spleen <span class="op">~</span><span class="st"> </span>body_wt_g_sac <span class="op">+</span><span class="st"> </span>genotype,</span>
<span id="cb69-2"><a href="data-reading-wrangling-and-writing.html#cb69-2"></a>         <span class="dt">data =</span> fig_s1f)</span>
<span id="cb69-3"><a href="data-reading-wrangling-and-writing.html#cb69-3"></a><span class="kw">coef</span>(<span class="kw">summary</span>(m1))</span></code></pre></div>
<pre><code>##                 Estimate   Std. Error   t value     Pr(&gt;|t|)
## (Intercept)   0.04238009 0.0242993900  1.744081 8.902319e-02
## body_wt_g_sac 0.00167493 0.0001506493 11.118067 1.170042e-13
## genotype-/-   0.23760586 0.0147600545 16.097898 8.072069e-19</code></pre>
<p>Here is the coefficient table of the fit model object that did explicitly tell <code>lm</code> how to handle missing data, using the argument <code>na.action = "na.exclude"</code>. These coefficient tables are the same.</p>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="data-reading-wrangling-and-writing.html#cb71-1"></a>m2 &lt;-<span class="st"> </span><span class="kw">lm</span>(spleen <span class="op">~</span><span class="st"> </span>body_wt_g_sac <span class="op">+</span><span class="st"> </span>genotype,</span>
<span id="cb71-2"><a href="data-reading-wrangling-and-writing.html#cb71-2"></a>         <span class="dt">data =</span> fig_s1f,</span>
<span id="cb71-3"><a href="data-reading-wrangling-and-writing.html#cb71-3"></a>         <span class="dt">na.action =</span> <span class="st">&quot;na.exclude&quot;</span>)</span>
<span id="cb71-4"><a href="data-reading-wrangling-and-writing.html#cb71-4"></a><span class="kw">coef</span>(<span class="kw">summary</span>(m2))</span></code></pre></div>
<pre><code>##                 Estimate   Std. Error   t value     Pr(&gt;|t|)
## (Intercept)   0.04238009 0.0242993900  1.744081 8.902319e-02
## body_wt_g_sac 0.00167493 0.0001506493 11.118067 1.170042e-13
## genotype-/-   0.23760586 0.0147600545 16.097898 8.072069e-19</code></pre>
</div>
</div>
<div id="butbeware-of-fitted-predicted-or-residual-values-from-regression-model-functions-unless-youve-explictly-told-the-function-how-to-handle-missing-values" class="section level4">
<h4><span class="header-section-number">2.3.6.2</span> But…beware of fitted, predicted, or residual values from regression model functions unless you’ve explictly told the function how to handle missing values</h4>
<p><strong>Use <code>na.action = "na.exclude"</code></strong> if you want to add the fitted (or predicted) values or residuals as new columns in the original data object (fig_sf1). Compare the length of the fitted values vector from models m1 (using the default “na.omit”) and m2 (using the “na.exclude”).</p>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb73-1"><a href="data-reading-wrangling-and-writing.html#cb73-1"></a><span class="kw">length</span>(<span class="kw">fitted</span>(m1))</span></code></pre></div>
<pre><code>## [1] 42</code></pre>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="data-reading-wrangling-and-writing.html#cb75-1"></a><span class="kw">length</span>(<span class="kw">fitted</span>(m2))</span></code></pre></div>
<pre><code>## [1] 55</code></pre>
<p>There are 55 observations (rows in the data) but only 42 complete rows with no missing values. The vector of fitted values from m1 has 42 fitted values. The vector of fitted values from m2 has 55 elements, the 42 fitted values plus 13 NA elements.</p>
<p>This is important if we want to do something like add the fitted values (or residuals, or some function of these) to the original data object (fig_sf1). Here I compute the spleen weights adjusted to the mean body weight of the control (“+/+”) group using the residuals from m1 and m2.</p>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb77-1"><a href="data-reading-wrangling-and-writing.html#cb77-1"></a>mean_x_control &lt;-<span class="st"> </span><span class="kw">mean</span>(fig_s1f[genotype <span class="op">==</span><span class="st"> &quot;+/+&quot;</span>, body_wt_g_sac])</span>
<span id="cb77-2"><a href="data-reading-wrangling-and-writing.html#cb77-2"></a>b &lt;-<span class="st"> </span><span class="kw">coef</span>(m1)</span>
<span id="cb77-3"><a href="data-reading-wrangling-and-writing.html#cb77-3"></a>fig_s1f[, spleen_adj_m1 <span class="op">:</span><span class="er">=</span><span class="st"> </span>b[<span class="dv">1</span>] <span class="op">+</span></span>
<span id="cb77-4"><a href="data-reading-wrangling-and-writing.html#cb77-4"></a><span class="st">          </span>b[<span class="dv">2</span>]<span class="op">*</span>mean_x_control <span class="op">+</span></span>
<span id="cb77-5"><a href="data-reading-wrangling-and-writing.html#cb77-5"></a><span class="st">          </span>b[<span class="dv">3</span>]<span class="op">*</span>(<span class="kw">as.integer</span>(genotype)<span class="op">-</span><span class="dv">1</span> <span class="op">+</span></span>
<span id="cb77-6"><a href="data-reading-wrangling-and-writing.html#cb77-6"></a><span class="st">          </span><span class="kw">residuals</span>(m1))]</span></code></pre></div>
<pre><code>## Warning in as.integer(genotype) - 1 + residuals(m1): longer object length
## is not a multiple of shorter object length</code></pre>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb79-1"><a href="data-reading-wrangling-and-writing.html#cb79-1"></a>fig_s1f[, spleen_adj_m2 <span class="op">:</span><span class="er">=</span><span class="st"> </span>b[<span class="dv">1</span>] <span class="op">+</span></span>
<span id="cb79-2"><a href="data-reading-wrangling-and-writing.html#cb79-2"></a><span class="st">          </span>b[<span class="dv">2</span>]<span class="op">*</span>mean_x_control <span class="op">+</span></span>
<span id="cb79-3"><a href="data-reading-wrangling-and-writing.html#cb79-3"></a><span class="st">          </span>b[<span class="dv">3</span>]<span class="op">*</span>(<span class="kw">as.integer</span>(genotype)<span class="op">-</span><span class="dv">1</span> <span class="op">+</span></span>
<span id="cb79-4"><a href="data-reading-wrangling-and-writing.html#cb79-4"></a><span class="st">          </span><span class="kw">residuals</span>(m2))]</span>
<span id="cb79-5"><a href="data-reading-wrangling-and-writing.html#cb79-5"></a><span class="co"># View(fig_s1f)</span></span></code></pre></div>
<p>The computation of “spleen_adj_m1” returns a warning that the values of <code>residuals(m1)</code> were recycled (the first 42 elements of the new column were filled with the 42 residuals and the last 13 elements of the new column were filled with the first 13 residuals) – after the first row of missing data, all of these computed adjusted values are wrong. Using <code>residuals(m2</code>), the adjusted values are matched to the correct row and the rows with missing variables do not have an adjusted value (because there is no residual to compute this).</p>
</div>
</div>
</div>
<div id="saving-data" class="section level2">
<h2><span class="header-section-number">2.4</span> Saving data</h2>
<p>For many projects, it is uncommon to save data. I might save simulated data if it takes a long time (tens of minutes to hours or even days) to generate these and I simply want to work with the simulated data in the future and not have to regenerate it. Or I might save processed data if it takes a long time to import and process and I want to analyze the processed data in the future and not have to re-import and process it.</p>
<p>If the data will only be used in this or future R projects, the data can be saved as an R object using <code>saveRDS()</code></p>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb80-1"><a href="data-reading-wrangling-and-writing.html#cb80-1"></a>outfile_name &lt;-<span class="st"> &quot;Prenatal acoustic communication programs offspring for high post-hatching temperatures in a songbird.Rds&quot;</span></span>
<span id="cb80-2"><a href="data-reading-wrangling-and-writing.html#cb80-2"></a>save_file_path &lt;-<span class="st"> </span><span class="kw">here</span>(output_folder, outfile_name)</span>
<span id="cb80-3"><a href="data-reading-wrangling-and-writing.html#cb80-3"></a><span class="kw">saveRDS</span>(<span class="dt">object =</span> chick, <span class="dt">file =</span> save_file_path)</span>
<span id="cb80-4"><a href="data-reading-wrangling-and-writing.html#cb80-4"></a></span>
<span id="cb80-5"><a href="data-reading-wrangling-and-writing.html#cb80-5"></a><span class="co"># to read this use</span></span>
<span id="cb80-6"><a href="data-reading-wrangling-and-writing.html#cb80-6"></a>chick &lt;-<span class="st"> </span><span class="kw">readRDS</span>(save_file_path)</span></code></pre></div>
<p>Reading a large .Rds file is very fast compared to reading the same data stored as a text file. However, if the data need to be imported into some other software, such as a spreadsheet, then save the data as a text file.</p>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb81-1"><a href="data-reading-wrangling-and-writing.html#cb81-1"></a><span class="co"># save the data to output folder</span></span>
<span id="cb81-2"><a href="data-reading-wrangling-and-writing.html#cb81-2"></a></span>
<span id="cb81-3"><a href="data-reading-wrangling-and-writing.html#cb81-3"></a><span class="co"># tab delimited</span></span>
<span id="cb81-4"><a href="data-reading-wrangling-and-writing.html#cb81-4"></a>outfile_name &lt;-<span class="st"> &quot;Prenatal acoustic communication programs offspring for high post-hatching temperatures in a songbird.txt&quot;</span></span>
<span id="cb81-5"><a href="data-reading-wrangling-and-writing.html#cb81-5"></a>save_file_path &lt;-<span class="st"> </span><span class="kw">here</span>(output_folder, outfile_name)</span>
<span id="cb81-6"><a href="data-reading-wrangling-and-writing.html#cb81-6"></a><span class="kw">write.table</span>(chick, save_file_path, <span class="dt">sep=</span><span class="st">&quot;</span><span class="ch">\t</span><span class="st">&quot;</span>, <span class="dt">quote=</span><span class="ot">FALSE</span>)</span>
<span id="cb81-7"><a href="data-reading-wrangling-and-writing.html#cb81-7"></a></span>
<span id="cb81-8"><a href="data-reading-wrangling-and-writing.html#cb81-8"></a><span class="co"># comma delimited</span></span>
<span id="cb81-9"><a href="data-reading-wrangling-and-writing.html#cb81-9"></a>outfile_name &lt;-<span class="st"> &quot;Prenatal acoustic communication programs offspring for high post-hatching temperatures in a songbird.csv&quot;</span></span>
<span id="cb81-10"><a href="data-reading-wrangling-and-writing.html#cb81-10"></a>save_file_path &lt;-<span class="st"> </span><span class="kw">here</span>(output_folder, outfile_name)</span>
<span id="cb81-11"><a href="data-reading-wrangling-and-writing.html#cb81-11"></a><span class="kw">write.table</span>(chick, save_file_path, <span class="dt">sep=</span><span class="st">&quot;,&quot;</span>, <span class="dt">quote=</span><span class="ot">FALSE</span>)</span></code></pre></div>
<p>Look at your project directory to make sure the file is where it should be! We used <code>write.table()</code> to create a tab-delimited text file using <code>sep="\t"</code> to specify tabs to separate the row elements. " is the standard character string for a tab. Check in your output folder and open the file in a text editor.</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="organization-r-projects-and-r-notebooks.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="plotting-models.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/rstudio/bookdown-demo/edit/master/chapters/06-data-reading_writing.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"download": ["Walker-elementary-statistical-modeling-draft.pdf", "Walker-elementary-statistical-modeling-draft.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
